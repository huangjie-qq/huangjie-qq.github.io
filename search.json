[{"title":"åˆ©ç”¨åå°„+è‡ªå®šä¹‰æ³¨è§£ å®ç°å„ç§Beanä¹‹é—´çš„è½»æ¾è½¬æ¢","url":"/2021/10/26/demo2/","content":"Beanè½¬æ¢å·¥å…·ç±»é»˜è®¤æŒ‰ç…§å­—åˆ—åç›¸åŒè½¬æ¢ ä¸åŒæ—¶é€šè¿‡@Copyæ³¨è§£æŒ‡å®šåˆ—å\nCopyUtilsç±»ï¼šæä¾›Beanè½¬æ¢æ–¹æ³•\n@Copyæ³¨è§£ï¼š ç”¨äºæ˜ å°„åˆ—åä¸ä¸€æ ·\n@Excludeæ³¨è§£ï¼šç”¨äºå–æ¶ˆå­—æ®µçš„æ˜ å°„ é»˜è®¤ä¸ºtrue\n\nApiè¯´æ˜ï¼š\nå•ä¸ªBeanè½¬æ¢ :  T copy(Object source,Class targetClass)\nå¤šä¸ªBeanè½¬æ¢ : List copy(List sourceList,Class targetClass)\nmapè½¬Bean   :  T toBean(Map&lt;String,Object&gt; map,Class targetClass)\nBeanè½¬Map   :  Map&lt;String,Object&gt; toMap(Object target)\n\næ³¨è§£ç”¨æ³•   @Data\n   public class User &#123;\n    \n    private String name;\n    \n    private Integer age;\n    \n   &#125;\n \n   @Data\n   @Builder\n   public class UserVo &#123;\n    \n    @Copy(&quot;name&quot;)//æŒ‡å®šè¦è½¬æ¢çš„åˆ—å\n    private String nameVo;\n    \n    private Integer age;\n    \n    @Exclude//æ’é™¤è¯¥å­—æ®µ é»˜è®¤ä¸ºtrue\n    private String sex;\n    \n   &#125;\n   \n\nğŸ‘‰ğŸ»å¿«é€Ÿå¼€å§‹   public static void main(String[] args) &#123;\n        \n        //å•ä¸ªBeanè½¬æ¢\n        UserVo userVo = UserVo.builder().nameVo(&quot;å°çƒæŸ&quot;).age(3).sex(&quot;ç”·&quot;).build();\n        User user = CopyUtils.copy(userVo, User.class);\n        \n        //å¤šä¸ªBeanè½¬æ¢\n        UserVo userVo1 = UserVo.builder().nameVo(&quot;å¼ ä¸‰&quot;).age(18).sex(&quot;ç”·&quot;).build();\n        UserVo userVo2 = UserVo.builder().nameVo(&quot;æå››&quot;).age(22).sex(&quot;ç”·&quot;).build();\n        List&lt;UserVo&gt; userVoList = Arrays.asList(userVo1, userVo2);\n        List&lt;User&gt; userList = CopyUtils.copy(userVoList, User.class);\n        \n        //mapè½¬Bean\n        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n        map.put(&quot;name&quot;,&quot;å°çƒæŸ&quot;);\n        map.put(&quot;age&quot;,20);\n        User user = CopyUtils.toBean(map, User.class);\n        \n        //Beanè½¬Map\n        Map&lt;String, Object&gt; map = CopyUtils.toMap(user);\n    &#125;\n   \n\nå¥½ç”¨çš„åŒå­¦ğŸ’ğŸ» ç‚¹ä¸ªæ˜Ÿå‘—åœ°å€\n","tags":["java"]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹å»ºé€ è€…æ¨¡å¼","url":"/2021/10/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/","content":"ä»‹ç»ï¼šå»ºé€ è€…æ¨¡å¼çš„å®šä¹‰æ˜¯ï¼šå°†å¤æ‚å¯¹è±¡çš„æ„é€ ä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºï¼Œè¿™æ ·çš„è®¾è®¡æ¨¡å¼è¢«ç§°ä¸ºå»ºé€ è€…æ¨¡å¼ã€‚\nä¸ºä»€ä¹ˆä½¿ç”¨æ„å»ºè€…æ¨¡å¼ï¼Ÿä»€ä¹ˆåœºæ™¯ä½¿ç”¨æ„å»ºè€…æ¨¡å¼ï¼Ÿ\nå‡å¦‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå¯¹è±¡çš„åˆ›å»ºéå¸¸çš„å¤æ‚ï¼Œå¯¹è±¡ä¸­è¿˜è¦å¯¹è±¡çš„å°è£…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ„å»ºè€…æ¨¡å¼ï¼Œå°†è¯¥å¯¹è±¡çš„æ„å»ºäº¤ç»™å®ƒæ¥å¤„ç†ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™æ‰¾ä»–è¦ä¸€ä¸ªå¯¹è±¡å°±å¯ä»¥äº†ã€‚\n\nå‡å¦‚ç°åœ¨æœ‰ä¸ªUserç±»å¦‚ä¸‹/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/10/27/17:48\n */\n@Data\npublic class User &#123;\n\n    private String name;\n    private int age;\n    private String sex;\n    private String phone;\n    private String address;\n\n&#125;    \n\nå½“æˆ‘ä»¬è¦æ„å»ºnameå­—æ®µå’Œageå­—æ®µæ—¶ æˆ‘ä»¬å¯ä»¥è¿™æ ·\npublic User(String name, int age) &#123;\n        this.name = name;\n        this.age = age;\n&#125;\n\nåŒç†å½“éœ€è¦æ„å»º nameå­—æ®µ ageå­—æ®µ  sexå­—æ®µæ—¶\npublic User(String name, int age, String sex) &#123;\n        this.name = name;\n        this.age = age;\n        this.sex = sex;\n&#125;\n\nå½“æˆ‘ä»¬æ¯æ¬¡éœ€è¦æ„é…ä¸åŒå¯¹è±¡æ—¶ï¼Œå°±è¦ä¸ºè¿™äº›å­—æ®µç”Ÿæˆä¸åŒçš„æ„é€ å‡½æ•°ï¼Œå¦‚æ­¤ä¸€æ¥ æˆ‘ä»¬çš„æ„é€ å‡½æ•°å°±ç‰¹åˆ«å¤š\nå¹¶ä¸”é˜…è¯»æ€§ä¹Ÿç‰¹åˆ«çš„ä¸å¥½ã€‚\nå½“ç„¶è¿˜æœ‰ä¸€ç§è§£å†³åŠæ³• å°±æ˜¯ç”Ÿæˆ get setæ–¹æ³•   public void setName(String name) &#123;\n        this.name = name;\n    &#125;\n\n    public void setAge(int age) &#123;\n        this.age = age;\n    &#125;\n\n    public void setSex(String sex) &#123;\n        this.sex = sex;\n    &#125;\n\n    public void setPhone(String phone) &#123;\n        this.phone = phone;\n    &#125;\n\n    public void setAddress(String address) &#123;\n        this.address = address;\n    &#125;\n\nå†™çš„æ—¶å€™è¿™æ ·å°±å¯ä»¥äº†\npublic static void main(String[] args) &#123;\n      User user=new User();\n      user.setName(&quot;å°çƒæŸ&quot;);\n      user.setAge(20);\n      user.setSex(&quot;ç”·&quot;);\n&#125;\n\nè¿™æ ·ä¸€æ¥å°±ç—›è‹¦çš„æ˜¯æˆ‘ä»¬ç¨‹åºå‘˜äº† è¿™ä¸ªæ—¶å€™æ„å»ºè€…å°±æ¥äº†\né¦–å…ˆæ¥ä¸ªé™æ€å†…éƒ¨ç±» å­—æ®µå’ŒUserç±»ä¿æŒä¸€è‡´/**\n     * å†…éƒ¨ç±»\n     */\n    public static class builder&#123;\n    \n        private String name;\n        private int age;\n        private String sex;\n        private String phone;\n        private String address;\n\n    &#125;\n\næä¾›æ„å»ºå„ä¸ªå­—æ®µçš„æ–¹æ³•     public builder name(String name)&#123;\n         this.name=name;\n         return this;\n     &#125;\n\n     public builder age(int age)&#123;\n         this.age=age;\n         return this;\n     &#125;\n\n     public builder sex(String sex)&#123;\n         this.sex=sex;\n         return this;\n     &#125;\n\n     public builder phone(String phone)&#123;\n         this.phone=phone;\n         return this;\n     &#125;\n\n     public builder address(String address)&#123;\n         this.address=address;\n         return this;\n     &#125;\n\næœ€åæä¾›æ„å»ºbuildæ–¹æ³• åŒæ—¶åœ¨Useræä¾›æ„é€ å‡½æ•°public User build()&#123;\n   return new User(this);\n&#125;\n\npublic User(builder builder)&#123;\n        this.name= builder.name;\n        this.age= builder.age;\n        this.sex= builder.sex;\n        this.phone= builder.phone;\n        this.address= builder.address;\n &#125;\n\nå®Œæ•´ä»£ç /**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/10/27/17:48\n */\n@Data\npublic class User &#123;\n\n    private String name;\n    private int age;\n    private String sex;\n    private String phone;\n    private String address;\n\n\n    public User() &#123;\n    &#125;\n\n    public User(builder builder)&#123;\n        this.name= builder.name;\n        this.age= builder.age;\n        this.sex= builder.sex;\n        this.phone= builder.phone;\n        this.address= builder.address;\n    &#125;\n\n    /**\n     * å†…éƒ¨ç±»\n     */\n    public static class builder&#123;\n    \n        private String name;\n        private int age;\n        private String sex;\n        private String phone;\n        private String address;\n\n        public builder name(String name)&#123;\n            this.name=name;\n            return this;\n        &#125;\n\n        public builder age(int age)&#123;\n            this.age=age;\n            return this;\n        &#125;\n\n        public builder sex(String sex)&#123;\n            this.sex=sex;\n            return this;\n        &#125;\n\n        public builder phone(String phone)&#123;\n            this.phone=phone;\n            return this;\n        &#125;\n\n        public builder address(String address)&#123;\n            this.address=address;\n            return this;\n        &#125;\n\n        public User build()&#123;\n            return new User(this);\n        &#125;\n\n    &#125;\n&#125;\n\nç”¨æ³•public static void main(String[] args) &#123;\n        User user1 = new User.builder().name(&quot;å°çƒæŸ&quot;).age(20).build();\n        User user2 = new User.builder().name(&quot;å°çƒæŸ&quot;).age(20).sex(&quot;ç”·&quot;).build();\n        System.out.println(user1);\n        System.out.println(user2);\n&#125;\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\nUser(name=å°çƒæŸ, age=20, sex=null, phone=null, address=null)\nUser(name=å°çƒæŸ, age=20, sex=ç”·, phone=null, address=null)\n\nç»ˆææ–¹æ³•ï¼šlombokçš„Builderæ³¨è§£@Data\n@Builder\n@AllArgsConstructor\n@NoArgsConstructor\npublic class User &#123;\n\n    private String name;\n    private int age;\n    private String sex;\n    private String phone;\n    private String address;\n    \n&#125;\n\nç”¨æ³• public static void main(String[] args) &#123;\n        User user = User.builder().name(&quot;å°çƒæŸ&quot;).age(20).sex(&quot;ç”·&quot;).build();\n        System.out.println(user);\n &#125;\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\nUser(name=å°çƒæŸ, age=20, sex=ç”·, phone=null, address=null)\n\n","tags":["è®¾è®¡æ¨¡å¼"]},{"title":"ç®€å•å®ç°å•ç‚¹ç™»å½•","url":"/2021/10/31/SSO-%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/","content":"ä»€ä¹ˆæ˜¯å•ç‚¹ç™»é™† ï¼Ÿ\nç”¨ç®€å•çš„è¯æ¥è®²å°±æ˜¯ å¤šä¸ªç³»ç»Ÿ  ä¸€å¤„ç™»é™† å¤„å¤„ç™»é™†\nåˆ›å»ºé¡¹ç›®mavené¡¹ç›®\nè®¤è¯ä¸­å¿ƒ\næœåŠ¡ä¸€\næœåŠ¡äºŒ\n\n\næ‰€æœ‰æ¨¡å—å¼•å…¥ä»¥ä¸‹ä¾èµ–\n &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;!--thymeleaf--&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;!--redisç¼“å­˜å¼•å…¥ --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;!--lombok--&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;version&gt;1.16.20&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!--fastjson--&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;\n            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;\n            &lt;version&gt;1.2.41&lt;/version&gt;\n        &lt;/dependency&gt;\n &lt;/dependencies&gt;\n\nè®¤è¯ä¸­å¿ƒé…ç½®å¦‚ä¸‹ï¼š\n# åº”ç”¨åç§°\nspring.application.name=attestation\nserver.port=8000\n\n# RedisæœåŠ¡å™¨åœ°å€\nspring.redis.host=127.0.0.1\n# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£\nspring.redis.port=6379\n\nclient1é…ç½®å¦‚ä¸‹ï¼š\n# åº”ç”¨åç§°\nspring.application.name=client1\nserver.port=8100\n\n# RedisæœåŠ¡å™¨åœ°å€\nspring.redis.host=127.0.0.1\n# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£\nspring.redis.port=6379\n\nclient2é…ç½®å¦‚ä¸‹ï¼š\n# åº”ç”¨åç§°\nspring.application.name=client2\nserver.port=8200\n\n# RedisæœåŠ¡å™¨åœ°å€\nspring.redis.host=127.0.0.1\n# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£\nspring.redis.port=6379\n\n\nä¸ºäº†æ¼”ç¤ºä¸åŒåŸŸåä¹‹é—´çš„ç™»å½• ä¿®æ”¹æœ¬åœ°hostsæ–‡ä»¶ï¼ˆæ–‡ä»¶ç›®å½•åœ¨C:\\Windows\\System32\\drivers\\etcï¼‰\n127.0.0.1 attestation.com\n\n127.0.0.1 client1\n\n127.0.0.1 client2\n\nåœ¨client1ä¸­  ç¼–å†™è®¤è¯æˆåŠŸåæ‰èƒ½è®¿é—®çš„é¡µé¢\n&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;UTF-8&quot;&gt;\n    &lt;title&gt;Title&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;SSO-æœåŠ¡ä¸€ è®¤è¯æˆåŠŸ&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\nåœ¨client1ç¼–å†™ä¸€ä¸ªç®€å•çš„Controller\n/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/10/31/0:03\n */\n@Controller\npublic class indexnController &#123;\n\n    @GetMapping(&quot;list&quot;)\n    public String list()&#123;\n        return &quot;list&quot;;\n    &#125;\n\n&#125;\n\né€šè¿‡æµè§ˆå™¨ è®¿é—®ï¼šhttp://client1:8100/list  ç»“æœå¦‚ä¸‹\n\nè¿™ä¸ªæ—¶å€™å°±è¦ç¼–å†™æˆ‘ä»¬çš„è®¤è¯é€»è¾‘ ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦ç™»å½•ã€‚\næ­£å¸¸é€šè¿‡sessionæ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½• ï¼Œç™»å½•æ­£å¸¸è®¿é—®ï¼Œæœªç™»å½•å°±é‡å®šå‘åˆ°æˆ‘ä»¬çš„è®¤è¯ä¸­å¿ƒå»ã€‚\nç¼–å†™è®¤è¯ä¸­å¿ƒ ç™»å½•é¡µé¢å’ŒController&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;UTF-8&quot;&gt;\n    &lt;title&gt;Title&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;SSO-è®¤è¯ä¸­å¿ƒ&lt;/h1&gt;\n&lt;form method=&quot;post&quot; action=&quot;&quot;&gt;\n    è´¦å·ï¼š&lt;input name=&quot;userName&quot; type=&quot;text&quot;&gt;&lt;br&gt;\n    å¯†ç ï¼š&lt;input name=&quot;password&quot; type=&quot;text&quot;&gt;&lt;br&gt;\n    ç™»é™† &lt;input type=&quot;submit&quot;&gt;\n    &lt;input type=&quot;hidden&quot; name=&quot;url&quot;&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\n@Controller\npublic class LoginController &#123;\n\n    /**\n     * è·³è½¬åˆ°ç™»å½•è§†å›¾\n     * @return\n     */\n    @GetMapping(&quot;login.html&quot;)\n    public String loginPage()&#123;\n        return &quot;login&quot;;\n    &#125;\n\n    /**\n     * å¤„ç†ç™»å½•é€»è¾‘\n     * @param user\n     * @return\n     */\n    @PostMapping(&quot;doLogin&quot;)\n    public String dolgoin(User user)&#123;\n        return null;\n    &#125;\n\n&#125;\n\n  @Data\n  public class User implements Serializable&#123;\n     private String userName;\n     private String password;\n  &#125;\n\nclient1ä»£ç  æ”¹åŠ¨å¦‚ä¸‹ï¼š\n    @GetMapping(&quot;list&quot;)\n    public String list(HttpSession session)&#123;\n        if(session.getAttribute(&quot;loginUser&quot;)==null)\n            return &quot;redirect:http://attestation.com:8000/login.html&quot;;\n        return &quot;list&quot;;\n    &#125;\n\nè¯·æ±‚æµç¨‹å˜æˆè¿™æ ·ï¼š\nclient1:8100/list â€”-ã€‹attestation.com:8000/login.html  â€”-ã€‹ç™»å½•è®¤è¯å  â€”-ã€‹attestation.com:8000/doLogin\né‚£ä¹ˆé—®é¢˜æ¥äº† å½“è®¤è¯ä¸­å¿ƒçš„dolgoinè¯·æ±‚å¤„ç†å®Œæˆä»¥å è¦è·³è½¬åˆ°é‚£é‡Œå»å‘¢ï¼Ÿ\næ­£å¸¸åº”è¯¥æ˜¯è·³è½¬åˆ°client1:8100/list ä¸­å» é‚£ä¹ˆæ€ä¹ˆæ‰èƒ½æ­£å¸¸è·³è½¬ã€‚\nå¯ä»¥åœ¨client1ä¸­è·³è½¬login.htmlè¯·æ±‚çš„æ—¶å€™æºå¸¦ä¸€ä¸ªredirect_ur1å‚æ•°ï¼Œlogin.htmlè¯·æ±‚æ¥æ”¶è¿™ä¸ªURLï¼Œå¹¶å°†è¿™ä¸ªå‚æ•°éšè—åœ¨å‰ç«¯ï¼Œ æäº¤dolgoinè¯·æ±‚çš„æ—¶å€™ä¼ é€’è¿™ä¸ªURLå³å¯ã€‚client1ä¸­ä»£ç æ”¹åŠ¨å¦‚ä¸‹ï¼š\n @GetMapping(&quot;list&quot;)\n    public String list(HttpSession session)&#123;\n        if(session.getAttribute(&quot;loginUser&quot;)==null)\n            return &quot;redirect:http://attestation.com:8000/login.html?redirect_ur1=http://client1:8100/list&quot;;\n        return &quot;list&quot;;\n    &#125;\n\nloginè¯·æ±‚æ”¹åŠ¨å¦‚ä¸‹ï¼š\n    @GetMapping(&quot;login.html&quot;)\n    public String loginPage(@RequestParam(&quot;redirect_ur1&quot;) String url, Model model)&#123;\n        model.addAttribute(&quot;url&quot;,url);\n        return &quot;login&quot;;\n    &#125;\n\né¡µé¢æ”¹åŠ¨å¦‚ä¸‹ï¼š\n&lt;form method=&quot;post&quot; action=&quot;doLogin&quot;&gt;\n    è´¦å·ï¼š&lt;input name=&quot;userName&quot; type=&quot;text&quot;&gt;&lt;br&gt;\n    å¯†ç ï¼š&lt;input name=&quot;password&quot; type=&quot;text&quot;&gt;&lt;br&gt;\n    &lt;input type=&quot;hidden&quot; name=&quot;url&quot; th:value=&quot;$&#123;url&#125;&quot;&gt;\n    ç™»é™† &lt;input type=&quot;submit&quot;&gt;\n&lt;/form&gt;\n\nä¸ºäº†æ–¹ä¾¿å°±å°†URLè¿™ä¸ªå‚æ•°æ·»åŠ åˆ°Userä¸­å»\n  @Data\n  public class User implements Serializable&#123;\n     private String userName;\n     private String password;\n     private String url;\n  &#125;\n\nè¿™ä¸ªæ—¶å€™dolgoinè¯·æ±‚å°±å¯ä»¥æ­£å¸¸çš„è·³è½¬å›å»äº†\n    @PostMapping(&quot;doLogin&quot;)\n    public String dolgoin(User user, HttpSession session)&#123;\n        session.setAttribute(&quot;loginUser&quot;,user);\n        return &quot;redirect:&quot;+user.getUrl();\n    &#125;\n\næ”¹åŠ¨å®Œä»£ç ä»¥å å¹¶ç™»é™†åè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n\næ˜æ˜ç™»é™†äº† ä¸ºä»€ä¹ˆè¿˜æ˜¯ä¼šè·³è½¬åˆ°è®¤è¯ä¸­å¿ƒå‘¢åŸå› å¦‚ä¸‹ï¼šåœ¨listè¯·æ±‚ä¸­æˆ‘ä»¬æ˜¯é€šè¿‡sessionæ¥åˆ¤æ–­æ˜¯å¦ç™»å½•ï¼Œ è™½ç„¶åœ¨è®¤è¯ä¸­å¿ƒç™»å½•ï¼Œ ä½†è®¤è¯ä¸­å¿ƒå­˜çš„session\n client1æ˜¯å–ä¸åˆ°  æ‰€ä»¥å°±ä¼šé‡æ–°è·³è½¬åˆ°è®¤è¯ä¸­å¿ƒå»ã€‚\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥æ¢ä¸€ä¸ªæ€è·¯ï¼Œå°†è®¤è¯ä¸­å¿ƒå­˜æ”¾çš„session æ”¾å…¥Redisä¸­å¹¶å°†å­˜å…¥æ—¶æ”¾çš„key åœ¨é‡å®šå‘çš„æ—¶å€™æºå¸¦ç»™client1 ï¼Œ client1 ä¸­æ¥æ”¶è¿™ä¸ªkeyæ¥åˆ¤æ–­å³å¯ã€‚è®¤è¯ä¸­å¿ƒä»£ç å˜åŒ–å¦‚ä¸‹ï¼š    @Resource\n    private RedisTemplate redisTemplate;\n\n    @PostMapping(&quot;doLogin&quot;)\n    public String dolgoin(User user)&#123;\n        String token= UUID.randomUUID().toString().replace(&quot;-&quot;,&quot;&quot;);\n        redisTemplate.opsForValue().set(token,JSON.toJSONString(user),30, TimeUnit.MINUTES);\n        return &quot;redirect:&quot;+user.getUrl()+&quot;?token=&quot;+token;\n    &#125;\n\nclient1ä»£ç å˜åŒ–å¦‚ä¸‹ï¼š    @Resource\n    private RedisTemplate redisTemplate;\n\n    @GetMapping(&quot;list&quot;)\n    public String list(@RequestParam(value = &quot;token&quot;,required = false) String token, HttpSession session)&#123;\n        if(!StringUtils.isEmpty(token))&#123;\n            String json = (String) redisTemplate.opsForValue().get(token);\n            User loginUser = JSON.parseObject(json, User.class);\n            if(loginUser!=null)\n                session.setAttribute(&quot;loginUser&quot;,loginUser);\n        &#125;\n        if(session.getAttribute(&quot;loginUser&quot;)==null)\n            return &quot;redirect:http://attestation.com:8000/login.html?redirect_ur1=http://client1:8100/list&quot;;\n        return &quot;list&quot;;\n    &#125;\n\nä¸ºäº†çœ‹åˆ°è®¤è¯åçš„æ•ˆæœ ä¿®æ”¹client1ä¸­HTMLä»£ç \n&lt;body&gt;\n&lt;h1&gt;SSO-æœåŠ¡ä¸€ è®¤è¯æˆåŠŸ&lt;/h1&gt;\n&lt;h1&gt;ç™»å½•ä¿¡æ¯å¦‚ä¸‹&lt;/h1&gt;\n&lt;h1 th:text=&quot;$&#123;session.loginUser==null?&#39;è´¦å·ï¼šæœªç™»å½•&#39;:&#39;è´¦å·ï¼š&#39;+session.loginUser.userName&#125;&quot;&gt;&lt;/h1&gt;\n&lt;h1 th:text=&quot;$&#123;session.loginUser==null?&#39;å¯†ç ï¼šæœªç™»å½•&#39;:&#39;å¯†ç ï¼š&#39;+session.loginUser.password&#125;&quot;&gt;&lt;/h1&gt;\n&lt;/body&gt;\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼šè®¿é—®http://client1:8100/list \n\næ­£å¸¸è·³è½¬åˆ°è®¤è¯ä¸­å¿ƒ ç™»å½•å æ­£å¸¸æ˜¾ç¤º\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æŠŠclient1ä»£ç å¤åˆ¶ç»™client2ï¼Œå¹¶ä¿®æ”¹é‡å®šå‘redirect_ur1å‚æ•°å˜æˆclient2çš„åœ°å€\n@GetMapping(&quot;list&quot;)\n    public String list(@RequestParam(value = &quot;token&quot;,required = false) String token, HttpSession session)&#123;\n        if(!StringUtils.isEmpty(token))&#123;\n            String json = (String) redisTemplate.opsForValue().get(token);\n            User loginUser = JSON.parseObject(json, User.class);\n            if(loginUser!=null)\n                session.setAttribute(&quot;loginUser&quot;,loginUser);\n        &#125;\n        if(session.getAttribute(&quot;loginUser&quot;)==null)\n            return &quot;redirect:http://attestation.com:8000/login.html?redirect_ur1=http://client2:8200/list&quot;;\n        return &quot;list&quot;;\n    &#125;\n\n å¯åŠ¨èµ·æ¥ è®¿é—®ï¼šhttp://client2:8200/list\n\nä¸ºä»€ä¹ˆæ˜¯è¿˜æ˜¯ä¼šè·³è½¬åˆ°è®¤è¯ä¸­å¿ƒå» åœ¨client1ä¸­ä¸æ˜¯ç™»å½•äº†å—åˆ†æä»£ç ï¼šé¦–å…ˆä¼šåˆ¤æ–­token æˆ‘ä»¬æ²¡æœ‰token ç„¶åä¼šåˆ¤æ–­session è¿™ä¸ªæ—¶å€™ä¹Ÿæ²¡æœ‰ æ‰€ä»¥ä¼šé‡å®šå‘åˆ°è®¤è¯ä¸­å¿ƒå» \nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨dolgoinè¯·æ±‚ç™»å½•åï¼Œåœ¨å­˜å…¥Redisçš„åŒæ—¶ï¼Œåœ¨Cookieä¸­ä¹ŸåŒæ—¶ä¿å­˜ä¸€ä»½ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨loginPageè¯·æ±‚ä¸­åˆ¤æ–­æ˜¯å¦æœ‰Cookie å¦‚æœæœ‰åˆ™è¯æ˜æœ‰äººç™»å½•è¿‡ ç›´æ¥è·³è½¬å›å»å³å¯ã€‚è®¤è¯ä¸­å¿ƒä»£ç å˜åŒ–å¦‚ä¸‹ï¼š\n   /**\n     * å¤„ç†ç™»å½•è¯·æ±‚\n     * @param user\n     * @param response\n     * @return\n     */\n    @PostMapping(&quot;doLogin&quot;)\n    public String dolgoin(User user, HttpServletResponse response)&#123;\n        String token= UUID.randomUUID().toString().replace(&quot;-&quot;,&quot;&quot;);\n        redisTemplate.opsForValue().set(token,JSON.toJSONString(user),30, TimeUnit.MINUTES);\n        Cookie cookie = new Cookie(&quot;sso_token&quot;, token);\n        response.addCookie(cookie);\n        return &quot;redirect:&quot;+user.getUrl()+&quot;?token=&quot;+token;\n    &#125;\n\n    /**\n     * è·³è½¬åˆ°ç™»å½•è§†å›¾\n     * @param url\n     * @param model \n     * @param token  \n     * @return\n     */\n    @GetMapping(&quot;login.html&quot;)\n    public String loginPage(@RequestParam(&quot;redirect_ur1&quot;) String url, Model model,\n                            @CookieValue(value = &quot;sso_token&quot;,required = false) String token)&#123;\n        if(!StringUtils.isEmpty(token))&#123;\n            return &quot;redirect:&quot;+url+&quot;?token=&quot;+token;\n        &#125;\n        model.addAttribute(&quot;url&quot;,url);\n        return &quot;login&quot;;\n    &#125;\n\næœ€åè¿è¡Œclient2 è®¿é—®ï¼šhttp://client2:8200/list\n\n ä»£ç åœ°å€\n","tags":["java"]},{"title":"ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼","url":"/2021/11/05/%E7%94%9F%E6%88%90%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F/","content":"ä¸€æ­¥ä¸€æ­¥èµ°è¿›ç”Ÿäº§æ¶ˆè´¹è€…é¦–æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ™®é€šjavaå·¥ç¨‹\nå®šä¹‰ä¸€ä¸ªå®ç°ç±» å®ç°ç”Ÿäº§æ–¹æ³•å’Œæ¶ˆè´¹æ–¹æ³• \nä¸ºäº†ç®€å• æˆ‘ä»¬å°±ç”¨ä½¿ç”¨æ™®é€šçš„synchronizedé”å’Œ  booleanå˜é‡æ¥åˆ¤æ–­æ˜¯å¦ç”Ÿäº§æ¶ˆè´¹ \n/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/06/0:01\n */\npublic class Realization &#123;\n    private Object lock;//é”\n    private boolean sign=true;//trueç”Ÿäº§ falseæ¶ˆè´¹ çœ‹å¥½è¿™ä¸ªçŠ¶æ€ä½ ä¸‹é¢å¾ˆé‡è¦\n\n    public Realization(Object lock) &#123;\n        this.lock = lock;\n    &#125;\n&#125;\n\nç¼–å†™ç”Ÿäº§æ–¹æ³•   /**\n     *ç”Ÿäº§æ–¹æ³•\n     */\n    public void producer()&#123;\n        synchronized (lock)&#123;\n            try&#123;\n                if(!sign)\n                    lock.wait();\n                System.out.println(Thread.currentThread().getName()+&quot; ç”Ÿäº§&quot;);\n                sign=false;\n                lock.notify();\n            &#125;catch (InterruptedException e)&#123;\n                e.printStackTrace();\n            &#125;\n        &#125;\n    &#125;\n\nç¼–å†™æ¶ˆè´¹è€…æ–¹æ³•   /**\n     * æ¶ˆè´¹æ–¹æ³•\n     */\n    public void consumer()&#123;\n        synchronized (lock)&#123;\n            try&#123;\n                if(sign)\n                    lock.wait();\n                System.out.println(Thread.currentThread().getName()+&quot; æ¶ˆè´¹&quot;);\n                sign=true;\n                lock.notify();\n            &#125;catch (InterruptedException e)&#123;\n                e.printStackTrace();\n            &#125;\n        &#125;\n    &#125;\n\nç¼–å†™ç”Ÿäº§è€…/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/06/00:16\n * ç”Ÿäº§è€…\n */\npublic class Producer implements Runnable&#123;\n    private Realization realization;\n    \n    public Producer(Realization realization) &#123;\n        this.realization = realization;\n    &#125;\n    \n    @Override\n    public void run() &#123;\n        while (true)&#123;\n            realization.producer();\n        &#125;\n    &#125;\n&#125;\n\nç¼–å†™æ¶ˆè´¹è€…/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/06/00:19\n * æ¶ˆè´¹è€…\n */\npublic class Consumer implements Runnable&#123;\n    private Realization realization;\n\n    public Consumer(Realization realization) &#123;\n        this.realization = realization;\n    &#125;\n    \n    @Override\n    public void run() &#123;\n       while (true)&#123;\n           realization.consumer();\n       &#125;   \n    &#125;\n&#125;\n\næœ€åç¼–å†™Mainæµ‹è¯•public static void main(String[] args) &#123;\n\n    Realization realization = new Realization(new Object());\n\n    Producer producer = new Producer(realization);\n    Consumer consumer = new Consumer(realization);\n\n    new Thread(producer,&quot;ç”Ÿäº§è€…&quot;).start();\n    new Thread(consumer,&quot;æ¶ˆè´¹è€…&quot;).start();\n&#125;\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n\nè¿è¡Œç»“æœä¹Ÿä¸é”™ ç”Ÿäº§ä¸€ä¸ªæ¶ˆè´¹å¤šä¸ª æ²¡æœ‰ä»€ä¹ˆé—®é¢˜\nä½†æˆ‘ä»¬å®é™…ä½¿ç”¨ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼çš„æ—¶å€™ä¸€èˆ¬æ˜¯ä¼šå¤šä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…\nè¿™ä¸ªæˆ‘ä»¬å¼€å¯å¤šä¸ªç”Ÿäº§è€…å’Œå¤šä¸ªæ¶ˆè´¹è€… è¯•ä¸€è¯•æˆ‘ä»¬çš„ä»£ç \npublic static void main(String[] args) &#123;\n\n        Realization realization = new Realization(new Object());\n\n        Producer producer = new Producer(realization);\n        Consumer consumer = new Consumer(realization);\n\n        new Thread(producer,&quot;ç”Ÿäº§è€…-1å·&quot;).start();\n        new Thread(producer,&quot;ç”Ÿäº§è€…-2å·&quot;).start();\n        new Thread(consumer,&quot;æ¶ˆè´¹è€…-1å·&quot;).start();\n        new Thread(consumer,&quot;æ¶ˆè´¹è€…-2å·&quot;).start();\n    &#125;\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n\nä¸ºä»€ä¹ˆä¼šè¿™ç§ ç”Ÿäº§ä¸€ä¸ª æ¶ˆè´¹ä¸¤æ¬¡çš„æƒ…å†µå‘¢ï¼Ÿ\næ¥çœ‹æ ¸å¿ƒä»£ç ï¼š\n1   if(sign)\n2       lock.wait();\n3   System.out.println(Thread.currentThread().getName()+&quot; æ¶ˆè´¹&quot;);\n4   sign=true;\n5   lock.notify();\n\nä¸Šé¢çš„booleanæ ‡è®°æ˜¯é»˜è®¤æ˜¯trueï¼Œæ‰€ä»¥æ˜¯è¦å…ˆç”Ÿäº§ åæ¶ˆè´¹\nç°åœ¨æˆ‘ä»¬æ¥æ¨¡æ‹Ÿ åˆšåˆšå‘é€çš„æƒ…å†µçš„è¿™ç§æƒ…å†µç”Ÿäº§è€…:t1 t2 æ¶ˆè´¹è€…ï¼št3 t41æ­¥ï¼š t3å¾—åˆ°è°ƒåº¦ åˆ¤æ–­If  ä¸º  true  t3ä¼‘çœ   ï¼ˆä¼‘çœ ï¼št3   çŠ¶æ€ä½ï¼štrueï¼‰\n2æ­¥ï¼šæ°å·§t4ä¹Ÿå¾—åˆ°è°ƒåº¦ å’Œt3ä¸€æ ·ä¼‘çœ  ï¼ˆä¼‘çœ ï¼št3  t4   çŠ¶æ€ä½ï¼štrueï¼‰\n3æ­¥ï¼št1å¾—åˆ°è°ƒåº¦ é¦–å…ˆåˆ¤æ–­if è¦ç”Ÿäº§ä¸€ä¸ªæ¶ˆæ¯ ç„¶åæ”¹å˜çŠ¶æ€ä½ ç”¨notify å”¤é†’äº†t3  (ä¼‘çœ ï¼št4   çŠ¶æ€ä½ï¼šfalse)\n4æ­¥ï¼št3å¾—åˆ°è°ƒåº¦ ä»ç¬¬2è¡Œä»£ç é†’æ¥çš„t3 ä¼šæ¥ç€å¾€ä¸‹æ‰§è¡Œ3 4è¡Œä»£ç  å¹¶æ”¹å˜çŠ¶æ€ä½  å”¤é†’çš„äººæ˜¯t4 (çŠ¶æ€ä½ï¼štrue)\n5æ­¥ï¼št4å¾—åˆ°è°ƒåº¦  ä»ç¬¬2è¡Œä»£ç é†’æ¥çš„t4   ä¼šæ¥ç€å¾€ä¸‹æ‰§è¡Œ3 4è¡Œä»£ç  æ”¹å˜çŠ¶æ€ä½ å”¤é†’\nå…¶å®åœ¨ç¬¬5æ­¥ t4å”¤é†’ å¾€ä¸‹æ‰§è¡Œçš„æ—¶å€™å°±é”™è¯¯äº† çŠ¶æ€ä½éƒ½æ˜¯true \né—®é¢˜å‡ºçš„åœ°æ–¹å°±æ˜¯ ä¸ç®¡æ˜¯ç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€… ï¼Œæ¯æ¬¡å”¤é†’çš„æ—¶å€™ ï¼Œéƒ½è¦å›å¤´åœ¨çœ‹ä¸€ä¸‹çŠ¶æ€ä½æ˜¯å¦æ­£ç¡® ï¼Œæ­£ç¡®åˆ™ç»§ç»­æ‰§è¡Œ å¦åˆ™å°±ç»§ç»­ä¼‘çœ ã€‚\nè§£å†³åŠæ³•ï¼šç”¨whileæ¥åˆ¤æ–­çŠ¶æ€ä½ä¿®æ”¹åçš„ç”Ÿäº§è€…æ–¹æ³•   /**\n     *ç”Ÿäº§æ–¹æ³•\n     */\n    public void producer()&#123;\n        synchronized (lock)&#123;\n            try&#123;\n                while(!sign)\n                    lock.wait();\n                System.out.println(Thread.currentThread().getName()+&quot; ç”Ÿäº§&quot;);\n                sign=false;\n                lock.notify();\n            &#125;catch (InterruptedException e)&#123;\n                e.printStackTrace();\n            &#125;\n        &#125;\n    &#125;\n\nä¿®æ”¹åçš„æ¶ˆè´¹è€…æ–¹æ³•   /**\n     * æ¶ˆè´¹æ–¹æ³•\n     */\n    public void consumer()&#123;\n        synchronized (lock)&#123;\n            try&#123;\n                while(sign)\n                    lock.wait();\n                System.out.println(Thread.currentThread().getName()+&quot; æ¶ˆè´¹&quot;);\n                sign=true;\n                lock.notify();\n            &#125;catch (InterruptedException e)&#123;\n                e.printStackTrace();\n            &#125;\n        &#125;\n    &#125;\n\nä¿®æ”¹å®Œä»£ç å æˆ‘ä»¬ç»§ç»­è¿è¡Œï¼š\n\nå¯ä»¥çœ‹åˆ°ç¨‹åºæ˜¯æ²¡æœ‰åœæ­¢äº† ä½†ä¸ºä»€ä¹ˆä¼šæ²¡æœ‰è¿è¡Œä¸‹å»å‘¢ï¼Ÿ\næ¥çœ‹æ ¸å¿ƒä»£ç ï¼š\nlock.notify();\n\nç°åœ¨æˆ‘ä»¬æ¥æ¨¡æ‹Ÿ åˆšåˆšå‘é€çš„æƒ…å†µçš„è¿™ç§æƒ…å†µç”Ÿäº§è€…:t1 t2 æ¶ˆè´¹è€…ï¼št3 t41æ­¥ï¼št3å¾—åˆ°è°ƒåº¦ åˆ¤æ–­çŠ¶æ€ä½ ä¼‘çœ   ï¼ˆä¼‘çœ ï¼št3ï¼‰\n2æ­¥ï¼št4å¾—åˆ°è°ƒåº¦  åˆ¤æ–­çŠ¶æ€ä½ ä¼‘çœ    (ä¼‘çœ ï¼št3  t4ï¼‰\n3æ­¥ï¼št1å¾—åˆ°è°ƒåº¦ åˆ¤æ–­çŠ¶æ€ä½  ç”Ÿäº§ å”¤é†’ t3   (ä¼‘çœ ï¼št4)\n4æ­¥ï¼št1åˆè¢«è°ƒåº¦  åˆ¤æ–­çŠ¶æ€ä½ ä¼‘çœ    (ä¼‘çœ ï¼št4  t1)\n5æ­¥ï¼št2å¾—åˆ°è°ƒåº¦  åˆ¤æ–­çŠ¶æ€ä½ ä¼‘çœ    (ä¼‘çœ ï¼št4  t1  t2)\n6æ­¥ï¼št3å¾—åˆ°è°ƒåº¦  åˆ¤æ–­çŠ¶æ€ä½  æ¶ˆè´¹  å”¤é†’t4  (ä¼‘çœ ï¼št1  t2)\n7æ­¥ï¼št3åˆè¢«è°ƒåº¦  åˆ¤æ–­çŠ¶æ€ä½  ä¼‘çœ   ï¼ˆä¼‘çœ ï¼št1 t2  t3ï¼‰\n8æ­¥ï¼šåªæœ‰t4å­˜æ´» å¾—åˆ°è°ƒåº¦ åˆ¤æ–­çŠ¶æ€ä½ ä¼‘çœ   ï¼ˆä¼‘çœ ï¼št1  t2 t3  t4ï¼‰\nè‡³æ­¤æ‰€ä»¥çº¿ç¨‹å…¨éƒ¨åˆ°äº†ä¼‘çœ çŠ¶æ€ ä¹Ÿæ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¼šå”¤é†’\nè§£å†³åŠæ³• ä½¿ç”¨lock.notifyAll();æ€»ç»“ï¼šåœ¨å¤šç”Ÿäº§è€…å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œåˆ¤æ–­çŠ¶æ€ä½çš„æ—¶å€™éœ€è¦ä½¿ç”¨whileåˆ¤æ–­ ï¼Œè¦ä¸ç„¶å¯èƒ½ä¼šé€ æˆ ä¸€æ¬¡ç”Ÿäº§å¤šæ¬¡æ¶ˆè´¹ï¼Œæˆ–è€…ä¸€æ¬¡æ¶ˆè´¹å¤šæ¬¡ç”Ÿäº§çš„æƒ…å†µï¼Œå”¤é†’çº¿ç¨‹ä½¿ç”¨notifyAll() ,è¦ä¸ç„¶å¯èƒ½ä¼šé€ æˆå…¨éƒ¨è¿›å…¥ä¼‘çœ çŠ¶æ€ å¯¼è‡´ç¨‹åºæ— æ³•è¿è¡Œã€‚å½“ç„¶è¿™åªæ˜¯ç”Ÿäº§è€… æ¶ˆè´¹è€…çš„ä¸€ç§å®ç°æ–¹æ³• è¿˜æœ‰å…¶ä»–å¤šç§å®ç°æ–¹æ³•ã€‚ ä»£ç åœ°å€\n","tags":["è®¾è®¡æ¨¡å¼"]},{"title":"æµ…è°ˆjavaä¸‰å…„å¼Ÿ","url":"/2021/11/09/java%E4%B8%89%E5%85%84%E5%BC%9F/","content":"javaå¯¹è±¡æ¨¡å‹ Javaå†…å­˜æ¨¡å‹ JVMå†…å­˜ç»“æ„è¿™ä¸‰å…„å¼Ÿä¸è¦å‚»å‚»åˆ†ä¸æ¸…\njavaå¯¹è±¡æ¨¡å‹ï¼šå°±æ˜¯å’±ä»¬ç»å¸¸åœ¨ä»£ç ä¸­newçš„å¯¹è±¡ å¯¹è±¡ä¿å­˜åœ¨å †ä¸­ï¼Œè€Œæˆ‘ä»¬åœ¨å¯¹å¯¹è±¡è¿›è¡Œæ“ä½œæ—¶ï¼Œå…¶å®æ“ä½œçš„æ˜¯å¯¹è±¡çš„å¼•ç”¨ã€‚\nJavaå¯¹è±¡åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ä¸€ä¸ªJavaå¯¹è±¡å¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œåˆ†åˆ«æ˜¯ï¼šå¯¹è±¡å¤´(Header)ã€å®ä¾‹æ•°æ®(Instance Data)å’Œå¯¹é½å¡«å……(Padding)ã€‚\n\n\nå¯¹è±¡å¤´ï¼šé»˜è®¤å­˜å‚¨ (å“ˆå¸Œå€¼(HashCode )ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³)ç­‰ä¿¡æ¯ã€‚\nå®ä¾‹æ•°æ®ï¼šå®ƒæ˜¯å¯¹è±¡çœŸæ­£å­˜å‚¨çš„æœ‰æ•ˆä¿¡æ¯,åŒ…æ‹¬ç¨‹åºä»£ç ä¸­å®šä¹‰çš„å„ç§ç±»å‹çš„å­—æ®µã€‚\nå¯¹é½å¡«å……ï¼šè™šæ‹Ÿæœºè¦æ±‚å¯¹è±¡èµ·å§‹åœ°å€æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ã€‚å¡«å……æ•°æ®ä¸æ˜¯å¿…é¡»å­˜åœ¨çš„,åªæ˜¯ä¸ºäº†å­—èŠ‚å¯¹é½ã€‚\n\njavaå†…å­˜æ¨¡å‹ï¼šJavaå†…å­˜æ¨¡å‹ä¹Ÿå°±æ˜¯å¸¸è¯´çš„JMM,æ˜¯ä¸€ç»„è§„èŒƒ,éœ€è¦å„ä¸ªJVMçš„å®ç°æ¥éµå®ˆJMMè§„èŒƒ,ä»¥ä¾¿äºå¼€å‘è€…å¯ä»¥åˆ©ç”¨è¿™äº›è§„èŒƒ,æ›´æ–¹ä¾¿åœ°å¼€å‘å¤šçº¿ç¨‹ç¨‹åºã€‚\nä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç»„è§„èŒƒï¼Ÿ\nåœ¨Cè¯­è¨€ä¸­ä¸å­˜åœ¨å†…å­˜æ¨¡å‹è¿™æ ·çš„æ¦‚å¿µï¼Œæ‰€ä»¥å¾ˆå¤šè¡Œä¸ºéƒ½æ˜¯ä¾èµ–å¤„ç†å™¨æœ¬èº«çš„ï¼Œè€Œä¸åŒçš„å¤„ç†å™¨ä¹‹é—´å¯¹synchronizedçš„ç†è§£ä¸ä¸€æ · ä¼šå¯¼è‡´å¤„ç†çš„ç»“æœä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚åœ¨ä¸€ä¸ªå¤„ç†ä¸Šæ˜¯ä¸€ä¸ªç»“æœï¼Œå¦ä¸€ä¸ªå¤„ç†ä¸Šåˆæ˜¯å…¶ä»–ç»“æœï¼Œä¹Ÿæ— æ³•ä¿è¯å¹¶å‘çš„å®‰å…¨ã€‚ç”±äºæˆ‘ä»¬javaæ˜¯è·¨å¹³å°ï¼Œæ‰€ä»¥è¿«åˆ‡çš„éœ€è¦ä¸€ç§è§„èŒƒæ¥ è®©å¤šçº¿ç¨‹è¿è¡Œçš„ç»“æœè¾¾åˆ°é¢„æœŸçš„ç»“æœã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„ä¸€ä¸ªJMMå†…å­˜æ¨¡å‹æ¥è§„èŒƒ,é‚£ä¹ˆå¾ˆå¯èƒ½ç»è¿‡äº†ä¸åŒJVMçš„ä¸åŒè§„åˆ™çš„é‡æ’åºä¹‹å,å¯¼è‡´ä¸åŒçš„è™šæ‹Ÿæœºä¸Šè¿è¡Œçš„ç»“æœä¸ä¸€æ ·,é‚£æ˜¯å¾ˆå¤§çš„é—®é¢˜ã€‚\nåœ¨è¿™äº›è§„èŒƒå½“ä¸­ æœ€é‡è¦çš„ä¸‰ç‚¹å°±æ˜¯ï¼šåŸå­æ€§ã€å¯è§æ€§ã€é‡æ’åº\nåŸå­æ€§ï¼šç”¨é€šä¿—çš„è¯æ¥è®² æ“ä½œä¸å¯ä¸­æ–­ ï¼Œå³ä½¿æ˜¯åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ä¹Ÿä¸å¯ä¸­æ–­ï¼Œè¦ä¸ç„¶æ‰§è¡ŒæˆåŠŸ ,è¦ä¸ç„¶ä¸æ‰§è¡Œ ã€‚\nåœ¨javaä¸­çš„åŸå­æ“ä½œæœ‰ ï¼š\n1.é™¤äº†longå’Œdoubleä¹‹å¤–çš„åŸºæœ¬ç±»å‹ èµ‹å€¼æ“ä½œ\n2.æ‰€æœ‰å¼•ç”¨çš„èµ‹å€¼æ“ä½œ\n3.åŸå­åŒ…ä¸‹çš„åŸå­ç±»çš„æ“ä½œ\nå¯è§æ€§ï¼šä¿è¯å¤šçº¿ç¨‹ä¹‹é—´çš„ä¿®æ”¹å˜é‡ å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿæ„ŸçŸ¥åˆ°ã€‚\nJMMæœ‰è§„å®š:\n1.æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼ŒåŒæ—¶æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±ç‹¬ç«‹çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜ä¸­çš„å˜é‡å†…å®¹æ˜¯ä¸»å†…å­˜ä¸­çš„æ‹·è´2.çº¿ç¨‹ä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œè€Œæ˜¯åªèƒ½æ“ä½œè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡,ç„¶åå†åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­3.ä¸»å†…å­˜æ˜¯å¤šä¸ªçº¿ç¨‹å…±äº«çš„ï¼Œä½†çº¿ç¨‹é—´ä¸å…±äº«å·¥ä½œå†…å­˜ï¼Œå¦‚æœçº¿ç¨‹é—´éœ€è¦é€šä¿¡ï¼Œå¿…é¡»å€ŸåŠ©ä¸»å†…å­˜ä¸­è½¬æ¥å®Œæˆæ‰€æœ‰çš„å…±äº«å˜é‡å­˜åœ¨äºä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æœ¬åœ°å†…å­˜,è€Œä¸”çº¿ç¨‹è¯»å†™å…±äº«æ•°æ®ï¼Œä¹Ÿæ˜¯é€šè¿‡æœ¬åœ°å†…å­˜äº¤æ¢çš„ï¼Œæ‰€ä»¥æ‰å¯¼è‡´äº†å¯è§æ€§é—®é¢˜ã€‚\n\né‚£ä¹ˆJMMæ€ä¹ˆä¿è¯å¯è§æ€§å‘¢ï¼š\nå½“æˆ‘ä»¬çš„å˜é‡åœ¨Synchronizeä¸­æˆ–è€…è¢«Volatileä¿®é¥°æ—¶\n\nå˜é‡çš„å†™æ“ä½œä¼šç«‹å³åˆ·åˆ°ä¸»å†…å­˜ä¸­ï¼Œç¡®ä¿å…¶ä»–çº¿ç¨‹å¯ä»¥è·å–åˆ°æœ€æ–°çš„å€¼ã€‚\nå˜é‡çš„è¯»æ“ä½œä¼šç›´æ¥è¯»å–ä¸»å†…å­˜ä¸­çš„å€¼ã€‚\n\nå½“ç„¶Volatileåªèƒ½ä¿è¯å˜é‡çš„å¯è§æ€§ å¹¶ä¸èƒ½åƒSynchronizeè¿˜èƒ½ä¿è¯åŸå­æ€§ï¼Œåœ¨è¿™é‡Œå°±ä¸è¯¦ç»†å±•å¼€äº†ã€‚\né‡æ’åºï¼šå°±æ˜¯ç¦æ­¢é‡æ’åºï¼Œé‚£ä¸ºä»€ä¹ˆä¼šæœ‰é‡æ’åºï¼Ÿï¼š\nå…¶å®è¯´åˆ°åº•éƒ½æ˜¯æºäºå¯¹æ€§èƒ½çš„ä¼˜åŒ–ï¼ŒCPUè¿è¡Œæ•ˆç‡ ç›¸æ¯”ç¼“å­˜ã€å†…å­˜ã€ç¡¬ç›˜IOä¹‹é—´æ•ˆç‡æœ‰ç€æŒ‡æ•°çº§çš„å·®åˆ«ï¼ŒCPUä½œä¸ºç³»ç»Ÿçš„å®è´µèµ„æºï¼Œé‚£ä¹ˆå¦‚ä½•æ›´å¥½çš„ä¼˜åŒ–å’Œåˆ©ç”¨è¿™ä¸ªèµ„æºå°±èƒ½æå‡æ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿçš„æ€§èƒ½\nä»Javaæºä»£ç åˆ°æœ€ç»ˆå®é™…æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ï¼Œä¼šåˆ†åˆ«ç»å†ä¸‹é¢3ç§é‡æ’åº\n\næŒ‡ä»¤é‡æ’åºçš„åŸåˆ™ï¼ˆas-if-serialè¯­ä¹‰ï¼‰ç¼–è¯‘å™¨å’Œå¤„ç†æŒ‡ä»¤ä¹Ÿå¹¶éä»€ä¹ˆåœºæ™¯éƒ½ä¼šè¿›è¡ŒæŒ‡ä»¤é‡æ’åºçš„ä¼˜åŒ–ï¼Œè€Œæ˜¯ä¼šéµå¾ªä¸€å®šçš„åŸåˆ™ï¼Œåªæœ‰åœ¨å®ƒä»¬è®¤ä¸ºé‡æ’åºåä¸ä¼šå¯¹ç¨‹åºç»“æœäº§ç”Ÿå½±å“çš„æ—¶å€™æ‰ä¼šè¿›è¡Œé‡æ’åºçš„ä¼˜åŒ–ï¼Œå¦‚æœé‡æ’åºä¼šæ”¹å˜ç¨‹åºçš„ç»“æœï¼Œé‚£è¿™æ ·çš„æ€§èƒ½ä¼˜åŒ–æ˜¾ç„¶æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚è€Œéµå®ˆas-if-serial è¯­ä¹‰è§„åˆ™å°±æ˜¯é‡æ’åºçš„ä¸€ä¸ªåŸåˆ™ï¼Œas-if-serial çš„æ„æ€æ˜¯è¯´ï¼Œå¯ä»¥å…è®¸ç¼–è¯‘å™¨å’Œå¤„ç†å™¨è¿›è¡Œé‡æ’åºï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ¡ä»¶ï¼Œå°±æ˜¯ä¸ç®¡æ€ä¹ˆé‡æ’åºéƒ½ä¸èƒ½æ”¹å˜å•çº¿ç¨‹æ‰§è¡Œç¨‹åºçš„ç»“æœã€‚\n1  a=1; //è¯­å¥1\n2  b=2; //è¯­å¥2\n3  a=a+3;\n\nå¯¹äºä¸Šé¢ä»£ç çš„æŒ‡ä»¤å¦‚ä¸‹ï¼š\n1.Load a\n2.Set to 1\n3.Store a\n4.Load b\n5.Set to 2\n6.Store b\n7.Load a\n8.Set to 4\n9.Store a\n\nCPUä¼šè®¤ä¸ºè¯­å¥1å’Œè¯­å¥2æ²¡æœ‰å…³ç³» é‡æ’åºåå˜æˆè¿™æ ·\n1  b=2;\n2  a=1;\n3  a=a+3;\n\nå¯¹äºçš„æŒ‡ä»¤å¦‚ä¸‹ï¼š\n1.Load b\n2.Set to 2\n3.Store b\n4.Load a\n5.Set to 1\n6.Set to 4\n7.Store a\n\nç»è¿‡é‡æ’åºåå°†9æ¡æŒ‡ä»¤ä¼˜åŒ–æˆ7æ¡ï¼Œé‚£ä¹ˆé‡æ’åºä¼šä¼˜åŒ–æˆ‘ä»¬çš„ç¨‹åº é‚£ä¹ˆä¸ºä»€ä¹ˆjmmè¿˜ä¼šæœ‰ç¦æ­¢é‡æ’åºå‘¢ï¼Ÿ\nçœ‹ä¸‹é¢ä»£ç \n  private static int value;\n     private static boolean flag;\n \n     public static  void  init()&#123;\n         value=1;     //è¯­å¥1\n         flag=true;  //è¯­å¥2\n     &#125;\n \n     public static void getValue()&#123;\n         if(flag)&#123;\n             System.out.println(value);\n         &#125;\n     &#125;\n\nåœ¨å•çº¿ç¨‹æƒ…å†µä¸‹ å¦‚æœä»£ç æ²¡æœ‰å‘é€é‡æ’åº é‚£ä¹ˆå…ˆè¿è¡Œinit() å†è¿è¡Œ getValue()æ–¹æ³•  æ‰“å°çš„ç»“æœ è‚¯å®šæ˜¯1\nå½“cpuè®¤ä¸ºè¯­å¥1å’Œè¯­å¥2æ²¡æœ‰å…³ç³»æ—¶ è¿›è¡Œäº†é‡æ’åºå¯èƒ½ä¼šå˜æˆè¿™æ ·\n   public static  void  init()&#123;\n         flag=true;  //è¯­å¥2\n         value=1;    //è¯­å¥1\n     &#125;\n\nè¿™ä¸ªæ—¶å€™ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«è°ƒç”¨ init()å’ŒgetValue()æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å‡ºç°è¿™ç§æƒ…å†µ\nçº¿ç¨‹ä¸€ æ‰§è¡Œ init() å½“æ‰§è¡Œåˆ°   flag=true; æ—¶  \nçº¿ç¨‹äºŒ é©¬ä¸Šæ‰§è¡Œå®Œ getValue()æ–¹æ³• ç„¶åä¼šæ‰“å°0\nç„¶åçº¿ç¨‹ä¸€åœ¨æŠŠ  value=1; æ‰§è¡Œå®Œæ¯•ã€‚\nè¿™æ ·å°±æ˜¯å¯¼è‡´å’Œæˆ‘ä»¬é¢„æœŸçš„ç»“æœä¸ä¸€è‡´ ,æˆ‘ä»¬é¢„æœŸçš„ç»“æœæ˜¯è°ƒç”¨  getValue()æ–¹æ³•æ‰“å°1å‡ºæ¥ ã€‚\næ‰€ä»¥åœ¨å¤æ‚çš„å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ˜¯æ ¹æœ¬æ— æ³•é€šè¿‡è¯­ä¹‰åˆ†ææ¥çŸ¥é“ä»£ç æŒ‡ä»¤çš„ä¾èµ–å…³ç³»çš„ï¼Œæ‰€ä»¥è¿™ä¸ªé—®é¢˜åªäº¤ç»™èƒ½å†™ä»£ç çš„äººæ‰èƒ½æ¸…æ¥šçš„çŸ¥é“ï¼Œè¿™ä¸ªæ—¶å€™ç¼–å†™ä»£ç çš„äººå°±éœ€è¦é€šè¿‡ä¸€ç§æ–¹å¼æ˜¾ç¤ºçš„å‘Šè¯‰ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å“ªäº›åœ°æ–¹æ˜¯å­˜åœ¨é€»è¾‘ä¾èµ–çš„ï¼Œè¿™äº›åœ°æ–¹ä¸èƒ½è¿›è¡Œé‡æ’åºã€‚\nä½¿ç”¨Volatileå°±èƒ½ä¿è¯ç¦æ­¢é‡æ’åºJVMå†…å­˜ç»“æ„Java è™šæ‹Ÿæœºåœ¨æ‰§è¡Œ Java ç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚\næ¯ä¸ªåŒºåŸŸéƒ½æœ‰å„è‡ªçš„ä½œç”¨ã€‚\n\nä¸Šé¢å›¾ä¸­ ç»¿è‰²åŒºåŸŸéƒ½æ˜¯çº¿ç¨‹å…±äº«çš„  é»„è‰²åŒºåŸŸéƒ½æ˜¯çº¿ç¨‹ç§æœ‰çš„ã€‚\nç¨‹åºè®¡æ•°å™¨ï¼šæ˜¯è®°ä½ä¸‹ä¸€æ¡jvmæŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ å½“æ‰§è¡Œçš„æ˜¯Nativeæ–¹æ³•æ˜¯ä¸º0  ,æ˜¯çº¿ç¨‹ç§æœ‰ å’Œå…¶ä»–åŒºä¸åŒçš„æ˜¯ ç¨‹åºè®¡æ•°å™¨æ°¸è¿œä¸ä¼šå†…å­˜æº¢å‡ºã€‚\njavaæ ˆï¼šæ¯å½“å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹æ—¶ï¼ŒJavaè™šæ‹Ÿæœºéƒ½ä¼šä¸ºå®ƒåˆ†é…ä¸€ä¸ªJavaæ ˆã€‚Javaæ ˆä»¥å¸§ä¸ºå•ä½ä¿å­˜çº¿ç¨‹çš„è¿è¡ŒçŠ¶æ€ã€‚è™šæ‹Ÿæœºåªä¼šç›´æ¥å¯¹Javaæ ˆæ‰§è¡Œä¸¤ç§æ“ä½œï¼šä»¥å¸§ä¸ºå•ä½çš„å‹æ ˆå’Œå‡ºæ ˆã€‚\nã€€ã€€æŸä¸ªçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•è¢«ç§°ä¸ºè¯¥çº¿ç¨‹çš„å½“å‰æ–¹æ³•ï¼Œå½“å‰æ–¹æ³•ä½¿ç”¨çš„æ ˆå¸§ç§°ä¸ºå½“å‰å¸§ï¼Œå½“å‰æ–¹æ³•æ‰€å±çš„ç±»ç§°ä¸ºå½“å‰ç±»ï¼Œå½“å‰ç±»çš„å¸¸é‡æ± ç§°ä¸ºå½“å‰å¸¸é‡æ± ã€‚åœ¨çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå®ƒä¼šè·Ÿè¸ªå½“å‰ç±»å’Œå½“å‰å¸¸é‡æ± ã€‚æ­¤å¤–ï¼Œå½“è™šæ‹Ÿæœºé‡åˆ°æ ˆå†…æ“ä½œæŒ‡ä»¤æ—¶ï¼Œå®ƒå¯¹å½“å‰å¸§å†…æ•°æ®æ‰§è¡Œæ“ä½œã€‚\nã€€ã€€æ¯å½“çº¿ç¨‹è°ƒç”¨ä¸€ä¸ªJavaæ–¹æ³•æ—¶ï¼Œè™šæ‹Ÿæœºéƒ½ä¼šåœ¨è¯¥çº¿ç¨‹çš„Javaæ ˆä¸­å‹å…¥ä¸€ä¸ªæ–°å¸§ã€‚è€Œè¿™ä¸ªæ–°å¸§è‡ªç„¶å°±æˆä¸ºäº†å½“å‰å¸§ã€‚åœ¨æ‰§è¡Œè¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå®ƒä½¿ç”¨è¿™ä¸ªå¸§æ¥å­˜å‚¨å‚æ•°ã€å±€éƒ¨å˜é‡ã€ä¸­é—´è¿ç®—ç»“æœç­‰æ•°æ®ã€‚\nã€€ã€€Javaæ–¹æ³•å¯ä»¥ä»¥ä¸¤ç§æ–¹å¼å®Œæˆã€‚ä¸€ç§é€šè¿‡returnè¿”å›çš„ï¼Œç§°ä¸ºæ­£å¸¸è¿”å›ï¼›ä¸€ç§æ˜¯é€šè¿‡æŠ›å‡ºå¼‚å¸¸è€Œå¼‚å¸¸ç»ˆæ­¢çš„ã€‚ä¸ç®¡ä»¥å“ªç§æ–¹å¼è¿”å›ï¼Œè™šæ‹Ÿæœºéƒ½ä¼šå°†å½“å‰å¸§å¼¹å‡ºJavaæ ˆç„¶åé‡Šæ”¾æ‰ï¼Œè¿™æ ·ä¸Šä¸€ä¸ªæ–¹æ³•çš„å¸§å°±æˆä¸ºå½“å‰å¸§äº†ã€‚\nã€€ã€€Javaå¸§ä¸Šçš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯æ­¤çº¿ç¨‹ç§æœ‰çš„ã€‚ä»»ä½•çº¿ç¨‹éƒ½ä¸èƒ½è®¿é—®å¦ä¸€ä¸ªçº¿ç¨‹çš„æ ˆæ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦è€ƒè™‘å¤šçº¿ç¨‹æƒ…å†µä¸‹æ ˆæ•°æ®çš„è®¿é—®åŒæ­¥é—®é¢˜ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œæ–¹æ³•çš„çš„å±€éƒ¨å˜é‡ä¿å­˜åœ¨è°ƒç”¨çº¿ç¨‹Javaæ ˆçš„å¸§ä¸­ã€‚åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ€»æ˜¯è®¿é—®é‚£äº›å±€éƒ¨å˜é‡ï¼Œå³è°ƒç”¨æ–¹æ³•çš„çº¿ç¨‹ã€‚\næœ¬åœ°æ–¹æ³•æ ˆï¼šJava è™šæ‹Ÿæœºçš„å®ç°å¯ä»¥ä½¿ç”¨ä¼ ç»Ÿçš„å †æ ˆï¼Œé€šä¿—åœ°ç§°ä¸ºâ€œC å †æ ˆâ€ï¼Œä»¥æ”¯æŒnativeæ–¹æ³•ï¼ˆç”¨ Java ç¼–ç¨‹è¯­è¨€ä»¥å¤–çš„è¯­è¨€ç¼–å†™çš„æ–¹æ³•ï¼‰ã€‚æœ¬æœºæ–¹æ³•å †æ ˆä¹Ÿå¯ä»¥ç”± Java è™šæ‹ŸæœºæŒ‡ä»¤é›†çš„è§£é‡Šå™¨å®ç°ä½¿ç”¨ï¼Œä¾‹å¦‚ C è¯­è¨€ã€‚æ— æ³•åŠ è½½native æ–¹æ³•ä¸”æœ¬èº«ä¸ä¾èµ–å¸¸è§„å †æ ˆçš„Java è™šæ‹Ÿæœºå®ç°ä¸éœ€è¦æä¾›æœ¬æœºæ–¹æ³•å †æ ˆ. å¦‚æœæä¾›ï¼Œåˆ™é€šå¸¸åœ¨åˆ›å»ºæ¯ä¸ªçº¿ç¨‹æ—¶ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æœ¬æœºæ–¹æ³•å †æ ˆã€‚\nå †åŒºï¼šJava è™šæ‹Ÿæœºæœ‰ä¸€ä¸ªåœ¨æ‰€æœ‰ Java è™šæ‹Ÿæœºçº¿ç¨‹ä¹‹é—´å…±äº«çš„å †ã€‚å †æ˜¯è¿è¡Œæ—¶æ•°æ®åŒºï¼Œä»ä¸­åˆ†é…æ‰€æœ‰ç±»å®ä¾‹å’Œæ•°ç»„çš„å†…å­˜ï¼Œçº¿ç¨‹å…±äº«çš„ã€‚\næ–¹æ³•åŒºï¼šJava è™šæ‹Ÿæœºæœ‰ä¸€ä¸ªåœ¨æ‰€æœ‰ Java è™šæ‹Ÿæœºçº¿ç¨‹ä¹‹é—´å…±äº«çš„æ–¹æ³•åŒºã€‚æ–¹æ³•åŒºç±»ä¼¼äºä¼ ç»Ÿè¯­è¨€çš„ç¼–è¯‘ä»£ç å­˜å‚¨åŒºï¼Œæˆ–ç±»ä¼¼äºæ“ä½œç³»ç»Ÿè¿›ç¨‹ä¸­çš„â€œæ–‡æœ¬â€æ®µã€‚å®ƒå­˜å‚¨æ¯ä¸ªç±»çš„ç»“æ„ï¼Œä¾‹å¦‚è¿è¡Œæ—¶å¸¸é‡æ± ã€å­—æ®µå’Œæ–¹æ³•æ•°æ®ï¼Œä»¥åŠæ–¹æ³•å’Œæ„é€ å‡½æ•°çš„ä»£ç ï¼ŒåŒ…æ‹¬åœ¨ç±»å’Œå®ä¾‹åˆå§‹åŒ–å’Œæ¥å£åˆå§‹åŒ–ä¸­ä½¿ç”¨çš„ç‰¹æ®Šæ–¹æ³•ã€‚\n1.6åœ¨å †åŒºä¸­ä½¿ç”¨ æ°¸ä¹…ä»£å®ç° ï¼Œ1.8ä½¿ç”¨å †å¤–å†…å­˜ å…ƒç©ºé—´å®ç°ã€‚\nä½¿ç”¨å…ƒç©ºé—´çš„å¥½å¤„æ˜¯\n1.å­—ç¬¦ä¸²å¸¸é‡æ± å­˜åœ¨æ°¸ä¹…ä»£ä¸­,å®¹æ˜“å‡ºç°æ€§èƒ½é—®é¢˜å’Œå†…å­˜æº¢å‡º2.ç±»å’Œæ–¹æ³•çš„ä¿¡æ¯å¤§å°éš¾æ˜“ç¡®å®š,ç»™æ°¸ä¹…ä»£çš„å¤§å°æŒ‡å®šå¸¦æ¥å›°éš¾3.æ°¸ä¹…ä»£ä¼šä¸ºGCå¸¦æ¥ä¸å¿…è¦çš„å¤æ‚æ€§\n","tags":["java"]},{"title":"å•ä¾‹çš„äº”ç§å®ç°","url":"/2021/11/16/%E5%8D%95%E4%BE%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","content":"è®¾è®¡æ¨¡å¼ä¹‹å•ä¾‹æ¨¡å¼ä»€ä¹ˆæ˜¯å•ä¾‹è®¾è®¡æ¨¡å¼ï¼Ÿ\nå•ä¾‹æ¨¡å¼ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ã€‚åœ¨å®ƒçš„æ ¸å¿ƒç»“æ„ä¸­åªåŒ…å«ä¸€ä¸ªè¢«ç§°ä¸ºå•ä¾‹çš„ç‰¹æ®Šç±»ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼å¯ä»¥ä¿è¯ç³»ç»Ÿä¸­ï¼Œåº”ç”¨è¯¥æ¨¡å¼çš„ç±»ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚å³ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚\nå…·ä½“å®ç°\néœ€è¦ï¼š\nï¼ˆ1ï¼‰å°†æ„é€ æ–¹æ³•ç§æœ‰åŒ–ï¼Œä½¿å…¶ä¸èƒ½åœ¨ç±»çš„å¤–éƒ¨é€šè¿‡newå…³é”®å­—å®ä¾‹åŒ–è¯¥ç±»å¯¹è±¡ã€‚\nï¼ˆ2ï¼‰åœ¨è¯¥ç±»å†…éƒ¨äº§ç”Ÿä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶ä¸”å°†å…¶å°è£…ä¸ºprivate staticç±»å‹ã€‚\nï¼ˆ3ï¼‰å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•è¿”å›è¿™ä¸ªå”¯ä¸€å¯¹è±¡ã€‚\né¥¿æ±‰å¼ï¼šé¡¾åæ€ä¹‰å¾ˆé¥¿ æ‰€ä»¥åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±åŠ è½½äº†å¯¹è±¡\n/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/16/23:47\n * é¥¿æ±‰å¼\n */\npublic class HungrySingleton &#123;\n    private HungrySingleton()&#123;&#125;;\n\n    private static final HungrySingleton SINGLETON=new HungrySingleton();\n\n    public static HungrySingleton getInstance()&#123;\n       return SINGLETON;\n    &#125;\n&#125;\n\né¥¿æ±‰å¼ä¼˜ç¼ºç‚¹ï¼šä¼˜ç‚¹ï¼šå®ç°èµ·æ¥ç®€å•ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚\nç¼ºç‚¹ï¼šå½“ç±»SingletonTestè¢«åŠ è½½çš„æ—¶å€™ï¼Œä¼šåˆå§‹åŒ–staticçš„instanceï¼Œé™æ€å˜é‡è¢«åˆ›å»ºå¹¶åˆ†é…å†…å­˜ç©ºé—´ï¼Œä»è¿™ä»¥åï¼Œè¿™ä¸ªstaticçš„instanceå¯¹è±¡ä¾¿ä¸€ç›´å ç€è¿™æ®µå†…å­˜ï¼ˆå³ä¾¿ä½ è¿˜æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªå®ä¾‹ï¼‰ï¼Œå½“ç±»è¢«å¸è½½æ—¶ï¼Œé™æ€å˜é‡è¢«æ‘§æ¯ï¼Œå¹¶é‡Šæ”¾æ‰€å æœ‰çš„å†…å­˜ï¼Œå› æ­¤åœ¨æŸäº›ç‰¹å®šæ¡ä»¶ä¸‹ä¼šè€—è´¹å†…å­˜ã€‚\næ‡’æ±‰å¼:å¾ˆæ‡’åªæœ‰è¦ç”¨æ—¶å€™æ‰ä¼šå»åŠ è½½\npackage com.xqm;\n\n/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/16/23:56\n * æ‡’æ±‰å¼\n */\npublic class LazySingleton &#123;\n    private LazySingleton()&#123;&#125;;\n    \n    private static LazySingleton SINGLETEN;\n    \n    public static LazySingleton getInstance()&#123;\n        if(SINGLETEN==null)&#123;   //è¯­å¥1\n            SINGLETEN=new LazySingleton(); //è¯­å¥2\n        &#125;\n        return SINGLETEN;\n    &#125;\n\n&#125;\n\nè¿™ç§å†™æ³•åœ¨å•çº¿ç¨‹æƒ…å†µä¸‹è¿™ç§ä¸‹æ˜¯æ²¡æœ‰å®‰å…¨é—®é¢˜çš„ã€‚\nå¤šçº¿ç¨‹æƒ…å†µä¸‹  å½“çº¿ç¨‹ä¸€å’Œçº¿ç¨‹äºŒ åŒæ—¶æ¥åˆ°è¯­å¥1 ç„¶ååˆ¤æ–­ä¸ºç©º åˆ†åˆ«ä¼šæ‰§è¡Œè¯­å¥2 æŠŠå¯¹è±¡åˆ›å»ºå¤šæ¬¡ã€‚\né‚£ä¹ˆä¸ºäº†çº¿ç¨‹å®‰å…¨ æˆ‘ä»¬è¿™æ ·ä¿®æ”¹ä»£ç \n public static synchronized LazySingleton getInstance()&#123;\n        if(SINGLETEN==null)&#123;\n            SINGLETEN=new LazySingleton();\n        &#125;\n        return SINGLETEN;\n    &#125;\n\nè¿™æ ·ä¿®æ”¹åè™½ç„¶æ²¡æœ‰å¤šçº¿ç¨‹ä¸‹æ²¡æœ‰é—®é¢˜ ï¼Œä½†æ˜¯ç›´æ¥æŠŠsynchronizedå¥—åœ¨æ–¹æ³•ä¸Š ï¼Œè®©æ–¹æ³•çš„æ‰§è¡Œæ•ˆç‡å¾ˆä½ï¼Œæ¯ä¸€æ¬¡åªèƒ½è®©ä¸€ä¸ªçº¿ç¨‹è¿›æ¥ å³ä½¿æ˜¯å¯¹è±¡å·²ç»ä¸ä¸ºç©ºåˆ›å»ºäº†ã€‚\né‚£ä¹ˆä¸ºäº†å³ä¿è¯çº¿ç¨‹å®‰å…¨åˆè¦ä¿è¯æ‰§è¡Œæ•ˆç‡ å°±è¦ç¼©å°synchronizedçš„ç²’åº¦ ä¸èƒ½ç›´æ¥ä½¿ç”¨åœ¨æ–¹æ³•ä¸Šã€‚\n public static  LazySingleton getInstance()&#123;\n        if(SINGLETEN==null)&#123;//è¯­å¥1\n            synchronized (LazySingleton.class)&#123;//è¯­å¥2\n                SINGLETEN=new LazySingleton();\n            &#125;\n        &#125;\n        return SINGLETEN;\n    &#125;\n\næŠŠç²’åº¦ç¼©å°åˆ°åˆ›å»ºå¯¹è±¡ä¸Š é‚£ä¹ˆè¿™æ ·å†™æœ‰æ²¡æœ‰é—®é¢˜å‘¢ï¼Ÿ\nå½“ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ ï¼Œçº¿ç¨‹ä¸€å’Œçº¿ç¨‹äºŒåŒæ—¶æ¥åˆ°è¯­å¥1ï¼Œåˆ¤æ–­ä¸ºç©ºæ‰§è¡Œè¯­å¥2çš„æ—¶å€™ ï¼Œè™½ç„¶åŠ äº†synchronized\nä½†ä¹Ÿåªæ˜¯è®©åŒä¸€æ—¶åˆ» ï¼Œæœ‰ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå¯¹è±¡è€Œå·²ï¼Œçº¿ç¨‹ä¸€åˆ›å»ºå®Œæˆä»¥å é‡Šæ”¾é”  çº¿ç¨‹äºŒæ‹¿åˆ°é” ç»§ç»­åˆ›å»ºå¯¹è±¡ã€‚\né‚£ä¹ˆé—®é¢˜å°±å‡ºç°åœ¨çº¿ç¨‹äºŒè¯­å¥2 çš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥åˆ›å»º è€Œåº”è¯¥å†æ¬¡åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºç©ºã€‚\n public static  LazySingleton getInstance()&#123;\n        if(SINGLETEN==null)&#123;//è¯­å¥1\n            synchronized (LazySingleton.class)&#123;//è¯­å¥2\n                if(SINGLETEN==null)&#123;\n                    SINGLETEN=new LazySingleton();\n                &#125;\n            &#125;\n        &#125;\n        return SINGLETEN;\n    &#125;\n\nè¿™æ ·çš„å†™æ³•å°±æ˜¯å¤§åé¼é¼çš„DCLåŒæ£€æŸ¥é”æœºåˆ¶  é‚£ä¹ˆè¿™æ ·å†™å°±çœŸçš„æ²¡æœ‰é—®é¢˜çš„äº†å—ï¼Ÿ\nåœ¨ä¸Šä¸€ç¯‡javaä¸‰å…„å¼Ÿä¸­è®²äº†JMMã€‚\n\nåˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹å¦‚ä¸Šå›¾ï¼Œå½“å‘ç”Ÿé‡æ’åºå ä¼šé¢ å€’ 2 3çš„æ‰§è¡Œé¡ºåºã€‚\nçº¿ç¨‹ä¸€  åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™  å‘ç”Ÿäº†é‡æ’åº  æ‰§è¡Œäº†3  è¿˜æ²¡æ¥å¾—åŠæ‰§è¡Œ2\nçº¿ç¨‹äºŒ  çœ‹åˆ°æŒ‡å‘çš„å†…å­˜åœ°å€ï¼Œå°±ä¼šåˆ¤æ–­ä¸ä¸ºç©ºï¼Œä»è€Œç›´æ¥è¿”å›ã€‚   å…¶å®è¿™ä¸ªæ—¶å€™å¯¹è±¡æ˜¯æ²¡æœ‰å®Œæˆåˆå§‹åŒ–çš„ï¼Œå½“å¤–ç•Œä½¿ç”¨å¯¹è±¡çš„æ—¶å€™ï¼Œ æ‰€ä»¥å°±ä¼šå‘ç”Ÿé”™è¯¯ã€‚\nä¸ºäº†è§£å†³å‘ç”Ÿé‡æ’åºé—®é¢˜ è¦ä½¿ç”¨volatileä¿®é¥°  æœ€ç»ˆä»£ç å¦‚ä¸‹public class LazySingleton &#123;\n    private LazySingleton()&#123;&#125;;\n\n    private static volatile LazySingleton SINGLETEN;\n\n    public static  LazySingleton getInstance()&#123;\n        if(SINGLETEN==null)&#123;\n            synchronized (LazySingleton.class)&#123;\n                if(SINGLETEN==null)&#123;\n                    SINGLETEN=new LazySingleton();\n                &#125;\n            &#125;\n        &#125;\n        return SINGLETEN;\n    &#125;\n\n&#125;\n\næ‡’æ±‰å¼ä¼˜ç¼ºç‚¹ï¼šä¼˜ç‚¹ï¼šå®ç°å»¶è¿ŸåŠ è½½ ä¸ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œèƒ½å¤ŸèŠ‚çº¦ä¸€å®šçš„å†…å­˜ã€‚\nç¼ºç‚¹ï¼šå®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œå¾—è€ƒè™‘å¤šçº¿ç¨‹æƒ…å†µä¸‹å‘ç”Ÿçš„é—®é¢˜ã€‚\né™æ€å†…å­˜ç±»åˆ©ç”¨åŠ è½½ä¸€ä¸ªç±»æ—¶ï¼Œå…¶å†…éƒ¨ç±»ä¸ä¼šåŒæ—¶è¢«åŠ è½½ã€‚å½“ä¸”ä»…å½“å…¶æŸä¸ªé™æ€æˆå‘˜ï¼ˆé™æ€åŸŸã€æ„é€ å™¨ã€é™æ€æ–¹æ³•ç­‰ï¼‰è¢«è°ƒç”¨æ—¶ï¼Œæ‰ä¼šè§¦å‘åŠ è½½ã€‚\n/**\n * @Authorï¼šçƒæŸ\n * @Dateï¼š2021/11/17/1:44\n * é™æ€å†…éƒ¨ç±»\n */\npublic class StaticInnerClassSingleton &#123;\n\n    private StaticInnerClassSingleton()&#123;&#125;\n\n    private static class InnerClass&#123;\n       private static StaticInnerClassSingleton singleton=new StaticInnerClassSingleton();\n    &#125;\n\n    public static StaticInnerClassSingleton getInstance()&#123;\n        return InnerClass.singleton;\n    &#125;\n\n&#125;\n\n\nè¿™ç§å†™æ³•åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹å°±æ²¡æœ‰å®‰å…¨é—®é¢˜å—ï¼Ÿ\nä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œ å½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åŠ è½½æ—¶ JVMä¼šä¿è¯åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å»åŠ è½½ï¼Œå³çº¿ç¨‹0åœ¨åŠ è½½æ—¶å†…éƒ¨å‘ç”Ÿäº†é‡æ’åºï¼Œç”±äºåŠ äº†é”ï¼Œæ•´ä¸ªé‡æ’åºå¯¹çº¿ç¨‹1æ˜¯ä¸å¯è§çš„ ï¼Œçº¿ç¨‹1åªèƒ½ç­‰å¾… çº¿ç¨‹0åŠ è½½å®Œæˆã€‚\næ‰€ä»¥å°±ä¸ä¼šå‡ºç°ä¸Šé¢è¿™ç§æƒ…å†µï¼Œä¸€ä¸ªçº¿ç¨‹å‘ç”Ÿé‡æ’åº è¿˜æ²¡æ‰§è¡Œå®Œ2çš„æ—¶å€™ ï¼Œè¢«å¦ä¸€ä¸ªçœ‹åˆ°å·²ç»æœ‰æŒ‡å‘çš„åœ°å€ï¼Œä»è€Œæ¥åˆ¤æ–­ä¸ä¸ºç©º ç›´æ¥è¿”å› ç„¶ååœ¨å¤–ç•Œä½¿ç”¨è¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡ã€‚ \né™æ€å†…éƒ¨ç±»ä¼˜ç¼ºç‚¹ï¼šä¼˜ç‚¹ï¼šä¹Ÿå®ç°å»¶è¿ŸåŠ è½½ ä¹Ÿèƒ½ä¿è¯çº¿ç¨‹çš„å®‰å…¨ã€‚\nç¼ºç‚¹ï¼šå®ç°èµ·æ¥è¿˜è¦é¢å¤–å†™ä¸€ä¸ªå†…éƒ¨ç±»ã€‚\nå®¹å™¨å•ä¾‹æ³•ï¼šspringå•ä¾‹Beanä¹Ÿæ˜¯åˆ©ç”¨å®¹å™¨å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ConcurrentHashMapæ¥å®ç°å•ä¾‹\n/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/17/1:54\n */\npublic class ContainerSingleton &#123;\n    private ContainerSingleton()&#123;&#125;;\n\n    private static ConcurrentHashMap&lt;String,ContainerSingleton&gt; map=new ConcurrentHashMap();\n\n    private static String KEY=&quot;singleten&quot;;\n\n    public static ContainerSingleton getInstance()&#123;\n        ContainerSingleton singleten = map.get(KEY);\n        return singleten!=null?singleten:map.computeIfAbsent(KEY,s-&gt; new ContainerSingleton());\n    &#125;\n\n&#125;\n\né€šè¿‡ä½¿ç”¨ConcurrentHashMapçš„computeIfAbsentæ–¹æ³•å®ç°ï¼Œèƒ½å¤Ÿå®ç°åŸå­æ€§çš„æ“ä½œï¼Œä»è€Œè¾¾åˆ°å¤šçº¿ç¨‹çš„å®‰å…¨ã€‚\nå®¹å™¨å•ä¾‹ä¼˜ç¼ºç‚¹ï¼šä¼˜ç‚¹ï¼šä¹Ÿå®ç°å»¶è¿ŸåŠ è½½ ä¹Ÿèƒ½ä¿è¯çº¿ç¨‹çš„å®‰å…¨ã€‚\nç¼ºç‚¹ï¼šè¿˜éœ€è¦é¢å¤–ä½¿ç”¨å®¹å™¨æ¥å­˜å‚¨å¯¹è±¡ï¼Œæµªè´¹äº†ä¸€å®šçš„å†…å­˜ã€‚\næšä¸¾å•ä¾‹ï¼šåˆ©ç”¨æšä¸¾æ¥å®ç°å•ä¾‹\n/**\n * @Authorï¼šçƒæŸ\n * @Dateï¼š2021/11/17/1:59\n * æšä¸¾æ³•\n */\npublic enum EnumSingleton  &#123;\n    INSTANCE;\n    private Object data;\n\n    private EnumSingleton()&#123;\n        data=new Object();\n    &#125;\n\n    public static EnumSingleton getInstance()&#123;\n        return INSTANCE;\n    &#125;\n\n    public Object getData()&#123;\n        return data;\n    &#125;\n\n&#125;\n\nJavaè§„èŒƒå­—è§„å®šï¼Œæ¯ä¸ªæšä¸¾ç±»å‹åŠå…¶å®šä¹‰çš„æšä¸¾å˜é‡åœ¨JVMä¸­éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤åœ¨æšä¸¾ç±»å‹çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸Šï¼ŒJavaåšäº†ç‰¹æ®Šçš„è§„å®šã€‚åœ¨åºåˆ—åŒ–çš„æ—¶å€™Javaä»…ä»…æ˜¯å°†æšä¸¾å¯¹è±¡çš„nameå±æ€§è¾“åˆ°ç»“æœä¸­ï¼Œååºåˆ—åŒ–çš„æ—¶å€™åˆ™æ˜¯é€šè¿‡java.lang.Enumçš„valueOf()æ–¹æ³•æ¥æ ¹æ®åå­—æŸ¥æ‰¾æšä¸¾å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåºåˆ—åŒ–çš„æ—¶å€™åªå°†DATASOURCEè¿™ä¸ªåç§°è¾“å‡ºï¼Œååºåˆ—åŒ–çš„æ—¶å€™å†é€šè¿‡è¿™ä¸ªåç§°ï¼ŒæŸ¥æ‰¾å¯¹åº”çš„æšä¸¾ç±»å‹ï¼Œå› æ­¤ååºåˆ—åŒ–åçš„å®ä¾‹ä¹Ÿä¼šå’Œä¹‹å‰è¢«åºåˆ—åŒ–çš„å¯¹è±¡å®ä¾‹ç›¸åŒã€‚\næšä¸¾å•ä¾‹ä¼˜ç¼ºç‚¹ï¼šä¼˜ç‚¹ï¼šå†™æ³•ç®€å•é«˜æ•ˆï¼Œå¤©ç„¶çš„é˜²æ­¢ååºåˆ—åŒ–å’Œåå°„ã€‚\nç¼ºç‚¹ï¼šåœ¨æˆ‘çœ‹æ¥æ²¡æœ‰ç¼ºç‚¹ã€‚\næ€»ç»“ï¼šå„ç§å†™æ³•éƒ½æœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ï¼Œé¢è¯•é—®çš„æ¯”è¾ƒå¤šå°±æ˜¯DCLåŒæ£€æŸ¥é”æœºåˆ¶  æœ€å®ç”¨çš„ä¹Ÿæ˜¯å°±æ˜¯æšä¸¾ï¼Œå½“ç„¶å…³äºå•ä¾‹çš„åºåˆ—åŒ–å’Œåå°„ç ´å ç•™åˆ°ä¸‹ä¸€ç¯‡æ¥è®²ã€‚ä»£ç åœ°å€\n","tags":["è®¾è®¡æ¨¡å¼"]},{"title":"ç ´åå•ä¾‹","url":"/2021/11/25/%E7%A0%B4%E5%9D%8F%E5%8D%95%E4%BE%8B/","content":"ç ´åå•ä¾‹æ€ä¹ˆç ´åå•ä¾‹å‘¢ï¼Ÿ\nå¯ä»¥ä»ååºåˆ—åŒ–å’Œåå°„æ¥ç ´åã€‚\nå¯¹äºä¸Šä¸€ç¯‡è®²çš„äº”ç§å†™æ³•ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥ç ´åï¼Œçœ‹çœ‹æ˜¯ä¸ªä»€ä¹ˆæƒ…å†µã€‚\né¥¿æ±‰å¼ï¼šååºåˆ—åŒ–æ”»å‡»ï¼šé¥¿æ±‰å¼public static void main(String[] args) throws Exception&#123;\n        HungrySingleton instance = HungrySingleton.getInstance();\n        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;instance_file&quot;));\n        oos.writeObject(instance);\n\n        File file = new File(&quot;instance_file&quot;);\n        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(file));\n        HungrySingleton readObject = (HungrySingleton)ois.readObject();\n\n        System.out.println(instance);\n        System.out.println(readObject);\n        System.out.println(instance==readObject);\n    &#125;\n\nè¿è¡Œç»“æœï¼š\n\nç»è¿‡äº†åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¹‹å ï¼Œé¥¿æ±‰å¼å°±äº§ç”Ÿäº†ä¸¤ä¸ªå¯¹è±¡ ï¼Œå¾ˆæ˜¾ç„¶è¿™æ ·å°±è¿èƒŒäº†å•ä¾‹è®¾è®¡çš„åŸåˆ™ã€‚ \né‚£ä¹ˆæ€ä¹ˆè§£å†³ååºåˆ—åŒ–æ”»å‡»å‘¢ï¼Ÿ\nåœ¨HungrySingletonä¸­ç¼–å†™ä¸€ä¸ªreadResolve()æ–¹æ³•ä»£ç å¦‚ä¸‹\n/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/16/23:47\n * é¥¿æ±‰å¼\n */\npublic class HungrySingleton implements Serializable &#123;\n    private HungrySingleton()&#123;&#125;;\n\n    private static final HungrySingleton SINGLETON=new HungrySingleton();\n\n    public static HungrySingleton getInstance()&#123;\n       return SINGLETON;\n    &#125;\n\n    /**\n     * é˜²æ­¢ååºåˆ—åŒ–\n     * @return\n     */\n    private Object readResolve()&#123;\n        return SINGLETON;\n    &#125;\n&#125;\n\nç„¶åé‡æ–°è¿è¡Œï¼š\n\nä¸ºä»€ä¹ˆæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªreadResolve()æ–¹æ³•å°±èƒ½ä¿è¯å®‰å…¨å‘¢ï¼Ÿ\nä»readObject()æ–¹æ³•å…¥æ‰‹åˆ†æã€‚\n\nè¿›åˆ° readObject0æ–¹æ³•ä¸­\n\nç»§ç»­è¿›åˆ° readOrdinaryObject(unshared)æ–¹æ³•ä¸­\n\nç»§ç»­è¿›åˆ° desc.isInstantiable()æ–¹æ³•ä¸­\n\nisInstantiable()æ–¹æ³•ä¸­çš„æ³¨é‡Šè®²ï¼Œå¦‚æœè¡¨ç¤ºçš„ç±»æ˜¯å¯åºåˆ—åŒ–/å¯å¤–éƒ¨åŒ–çš„å¹¶ä¸”å¯ä»¥ç”±åºåˆ—åŒ–è¿è¡Œæ—¶å®ä¾‹åŒ–ï¼Œåˆ™è¿”å› true  ã€‚\né‚£ä¹ˆ2011è¡Œä»£ç çš„ desc.isInstantiable()è¿”å›true  ï¼Œæ ¹æ®ä¸‰ç›®è¿ç®—ç¬¦ï¼Œå°±ä¼šæ‰§è¡Œ desc.newInstance()æ–¹æ³•ã€‚\nç»§ç»­è¿›åˆ°newInstance()æ–¹æ³•\n\nåœ¨è¿™é‡Œæœ€ä¸»è¦çš„ä¸€å¥æ˜¯ cons.newInstance();\né‚£æˆ‘ä»¬çœ‹çœ‹ consæ˜¯ä¸ªä»€ä¹ˆ\n\nåŸæ˜¯ä¸€ä¸ªæ„é€ å™¨ï¼Œæ‰€ä»¥cons.newInstance(); å°±æ˜¯ç”¨åå°„åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ã€‚\næ‰€ä»¥åœ¨è¿™é‡Œä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆä¼šç ´åå•ä¾‹ å®ƒæ˜¯ç”¨åå°„newäº†ä¸ªæ–°å¯¹è±¡ã€‚\nè¿™æ ·ä¸€æ¥2009è¡Œçš„ objå¯¹è±¡å°±ä¸ä¸ºç©ºã€‚æˆ‘ä»¬ç»§ç»­å¾€readOrdinaryObject()æ–¹æ³•å¾€ä¸‹çœ‹\n\næ¥åˆ°2032è¡Œï¼Œå› ä¸ºobjä¸ä¸ºç©º æ‰€ä»¥ä¼šæ‰§è¡Œåˆ° 2033è¡Œçš„handles.lookupException(passHandle)æ–¹æ³•\næˆ‘ä»¬å…ˆæ¥çœ‹ ä¼ é€’çš„å‚æ•°passHandleç­‰äºä»€ä¹ˆã€‚\n\nç„¶åç»§ç»­è¿›åˆ°lookupException()æ–¹æ³•ä¸­å»\n\nlookupException()æ–¹æ³•ä¸­çš„æ³¨é‡Šä¹Ÿè¯´å¾—å¾ˆæ¸…æ¥šäº†ï¼Œ å¦‚æœç»™å®šçš„å¥æŸ„æ˜¯ NULL_HANDLEï¼Œæˆ–è€…æ²¡æœ‰ä¸å¥æŸ„å…³è”çš„ ClassNotFoundExceptionï¼Œåˆ™è¿”å› nullã€‚\næ‰€ä»¥2033è¡Œä¸­çš„ handles.lookupException(passHandle) == null ä¸ºtrue ã€‚\nä¼šç»§ç»­æ‰§è¡Œ2034è¡Œçš„desc.hasReadResolveMethod()æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›å»ã€‚\n\nhasReadResolveMethodæ–¹æ³•çš„æ³¨é‡Šä¹Ÿè¯´å¾—å¾ˆæ˜ç™½äº†ï¼Œå®šä¹‰äº†ä¸€è‡´çš„ readResolve æ–¹æ³•ï¼Œåˆ™è¿”å› trueã€‚\nå› ä¸ºæˆ‘ä»¬å†™äº†ä¸€ä¸ªreadResolve æ–¹æ³•ï¼Œæ‰€ä»¥æ•´ä¸ªè¡¨è¾¾å¼çš„ç»“æœä¸ºtrue ï¼Œè¿›å…¥ifã€‚\næ‰§è¡Œ2036è¡Œçš„Object rep = desc.invokeReadResolve(obj)ä»£ç ã€‚\nç»§ç»­è¿›åˆ° invokeReadResolve(obj)æ–¹æ³•ä¸­\n\ninvokeReadResolveæ–¹æ³•çš„æ³¨é‡Šè¯´ï¼ŒreadResolve æ–¹æ³•å¹¶è¿”å›ç»“æœã€‚\næˆ‘ä»¬åœ¨HungrySingletonä¸­çš„ä»£ç æ˜¯è¿”å›å•ä¾‹å¯¹è±¡\n /**\n     * é˜²æ­¢ååºåˆ—åŒ–\n     * @return\n     */\n    private Object readResolve()&#123;\n        return SINGLETON;\n    &#125;\n\næ‰€ä»¥åœ¨2036è¡Œä»£ç ä¸­çš„rep ç­‰äºæˆ‘ä»¬çš„å•ä¾‹å¯¹è±¡ã€‚\nç»§ç»­å¾€ä¸‹çœ‹\n\næ¥åˆ°2040è¡Œä»£ç ï¼Œ repæ˜¯å•ä¾‹å¯¹è±¡  objæ˜¯åå°„çš„å¯¹è±¡ è‡ªç„¶ä¸ä¼šç›¸ç­‰ è¿›å…¥ifï¼Œæœ€ç»ˆå°†objæŒ‡å‘å•ä¾‹å¯¹è±¡ å¹¶è¿”å›å‡ºå»ã€‚\næ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå†™ä¸€ä¸ªreadResolve()æ–¹æ³•å°±èƒ½é˜²æ­¢ååºåˆ—åŒ–æ”»å‡»äº†ã€‚\nå°ç»“ï¼šreadObject()æ–¹æ³•ä¼šæ£€æŸ¥ç±»ä¸­æœ‰æ²¡æœ‰readResolve()æ–¹æ³•ï¼Œå¦‚æœæœ‰åˆ™è°ƒç”¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨readResolve()æ–¹æ³•ä¸­æ·»åŠ æˆ‘ä»¬çš„é€»è¾‘ ï¼Œä»è€Œè¾¾åˆ°å•ä¾‹çš„å®‰å…¨ã€‚\nååºåˆ—åŒ–æ”»å‡»çœ‹å®Œäº†ï¼Œæˆ‘ä»¬ç»§ç»­æ¥çœ‹åå°„æ”»å‡»ã€‚\nåå°„æ”»å‡»ï¼šé¥¿æ±‰å¼ public static void main(String[] args) throws Exception&#123;\n\n        HungrySingleton instance = HungrySingleton.getInstance();\n\n        Class&lt;HungrySingleton&gt; aClass = HungrySingleton.class;\n        Constructor&lt;HungrySingleton&gt; constructor = aClass.getDeclaredConstructor();\n        constructor.setAccessible(true);\n        HungrySingleton newInstance = constructor.newInstance(null);\n\n        System.out.println(instance);\n        System.out.println(newInstance);\n        System.out.println(instance==newInstance);\n    &#125;\n\nè¿è¡Œç»“æœï¼š\n\né€šè¿‡åå°„ æ‰“å¼€ç§æœ‰æ„é€ å™¨æƒé™ï¼Œå°±å¯ä»¥newå‡ºæ–°çš„å¯¹è±¡ï¼Œä»è€Œç ´åå•ä¾‹ã€‚\né‚£ä¹ˆæ€ä¹ˆè§£å†³å‘¢ï¼Ÿ\nprivate HungrySingleton()&#123;\n      if(SINGLETON!=null)\n        throw new RuntimeException(&quot;å•ä¾‹æ„é€ å™¨ ç¦æ­¢åå°„ç ´å&quot;);\n &#125;;\n\nåœ¨ç§æœ‰æ„é€ å‡½æ•°ä¸­åˆ¤æ–­ï¼Œç¦æ­¢newå‡ºå¯¹è±¡ã€‚\nå› ä¸ºé¥¿æ±‰å¼æ˜¯åœ¨ç±»åŠ è½½é˜¶æ®µæ—¶å€™åˆ›å»ºçš„ï¼Œåœ¨åå°„ä»£ç è°ƒç”¨æ—¶å°±å·²ç»å­˜åœ¨ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\nä»è€Œä¸ä¼šnewå‡ºä¸¤æ¬¡ï¼Œè¾¾åˆ°é˜²æ­¢åå°„å®‰å…¨ã€‚\né™æ€å†…éƒ¨ç±»ï¼šååºåˆ—åŒ–æ”»å‡»ï¼šé™æ€å†…éƒ¨ç±» public static void main(String[] args) throws Exception&#123;\n\n        StaticInnerClassSingleton instance = StaticInnerClassSingleton.getInstance();\n        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;instance_file&quot;));\n        oos.writeObject(instance);\n\n        File file = new File(&quot;instance_file&quot;);\n        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(file));\n        StaticInnerClassSingleton readObject = (StaticInnerClassSingleton)ois.readObject();\n\n        System.out.println(instance);\n        System.out.println(readObject);\n        System.out.println(instance==readObject);\n    &#125;\n\nç»“æœå’Œä¸Šé¢é¥¿æ±‰å¼è¡¨ç°ä¸€æ ·ï¼Œä¼šè¢«ç ´åï¼Œéœ€è¦ç¼–å†™ä¸€ä¸ªreadResolve()æ–¹æ³•ä»£ç ï¼Œæ‰èƒ½ååºåˆ—åŒ–å®‰å…¨ã€‚\n/**\n * @Authorï¼šçƒæŸ\n * @Dateï¼š2021/11/17/1:44\n * é™æ€å†…éƒ¨ç±»\n */\npublic class StaticInnerClassSingleton implements Serializable &#123;\n\n    private StaticInnerClassSingleton()&#123;&#125;\n\n    private static class InnerClass&#123;\n       private static StaticInnerClassSingleton singleton=new StaticInnerClassSingleton();\n    &#125;\n\n    public static StaticInnerClassSingleton getInstance()&#123;\n        return InnerClass.singleton;\n    &#125;\n\n    /**\n     * é˜²æ­¢ååºåˆ—åŒ–\n     * @return\n     */\n    private Object readResolve()&#123;\n        return InnerClass.singleton;\n    &#125;\n&#125;\n\nåå°„æ”»å‡»ï¼šé™æ€å†…éƒ¨ç±» public static void main(String[] args) throws Exception&#123;\n\n        StaticInnerClassSingleton instance = StaticInnerClassSingleton.getInstance();\n\n        Class&lt;StaticInnerClassSingleton&gt; aClass = StaticInnerClassSingleton.class;\n        Constructor&lt;StaticInnerClassSingleton&gt; constructor = aClass.getDeclaredConstructor();\n        constructor.setAccessible(true);\n        StaticInnerClassSingleton newInstance = constructor.newInstance(null);\n\n        System.out.println(instance);\n        System.out.println(newInstance);\n        System.out.println(instance==newInstance);\n    &#125;\n\nè¡¨ç°ç»“æœè¿˜æ˜¯å’Œä¸Šé¢é¥¿æ±‰å¼ï¼Œä¹Ÿé˜²å¾¡ä¸äº†åå°„æ”»å‡»ï¼Œä¹Ÿéœ€è¦åœ¨æ„é€ å‡½æ•°ä¸­åˆ¤æ–­ã€‚\n/**\n * @Authorï¼šçƒæŸ\n * @Dateï¼š2021/11/17/1:44\n * é™æ€å†…éƒ¨ç±»\n */\npublic class StaticInnerClassSingleton implements Serializable &#123;\n\n    private StaticInnerClassSingleton()&#123;\n        if(InnerClass.singleton!=null)\n            throw new RuntimeException(&quot;å•ä¾‹æ„é€ å™¨ ç¦æ­¢åå°„ç ´å&quot;);\n    &#125;\n\n    private static class InnerClass&#123;\n       private static StaticInnerClassSingleton singleton=new StaticInnerClassSingleton();\n    &#125;\n\n    public static StaticInnerClassSingleton getInstance()&#123;\n        return InnerClass.singleton;\n    &#125;\n\n    /**\n     * é˜²æ­¢ååºåˆ—åŒ–\n     * @return\n     */\n    private Object readResolve()&#123;\n        return InnerClass.singleton;\n    &#125;\n&#125;\n\nå› ä¸ºé™æ€å†…éƒ¨ç±»ï¼Œä¹Ÿæ˜¯åœ¨ä½¿ç”¨æ˜¯æ‰åŠ è½½ï¼Œæ‰€ä»¥ä¹Ÿèƒ½ä¿è¯åå°„çš„å®‰å…¨ã€‚\næ‡’æ±‰å¼ï¼šåºåˆ—åŒ–æ”»å‡»ï¼šæ‡’æ±‰å¼public static void main(String[] args) throws Exception&#123;\n\n        LazySingleton instance = LazySingleton.getInstance();\n        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;instance_file&quot;));\n        oos.writeObject(instance);\n\n        File file = new File(&quot;instance_file&quot;);\n        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(file));\n        LazySingleton readObject = (LazySingleton)ois.readObject();\n\n        System.out.println(instance);\n        System.out.println(readObject);\n        System.out.println(instance==readObject);\n    &#125;\n\nç»“æœå’Œä¸Šé¢éƒ½æ˜¯ä¸€æ ·ï¼Œé˜²å¾¡ä¸äº†åºåˆ—åŒ–æ”»å‡»ï¼Œä¹Ÿæ˜¯è¦æä¾›readResolve()æ–¹æ³•ã€‚\n/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/16/23:56\n * æ‡’æ±‰å¼\n */\npublic class LazySingleton implements Serializable &#123;\n    private LazySingleton()&#123;&#125;;\n\n    private static volatile LazySingleton SINGLETEN;\n\n    public static LazySingleton getInstance()&#123;\n        if(SINGLETEN==null)&#123;//è¯­å¥1\n            synchronized (LazySingleton.class)&#123;//è¯­å¥2\n                if(SINGLETEN==null)&#123;\n                    SINGLETEN=new LazySingleton();\n                &#125;\n            &#125;\n        &#125;\n        return SINGLETEN;\n    &#125;\n\n    /**\n     * é˜²æ­¢ååºåˆ—åŒ–\n     * @return\n     */\n    private Object readResolve()&#123;\n        return SINGLETEN;\n    &#125;\n&#125;\n\nåå°„æ”»å‡»ï¼šæ‡’æ±‰å¼ public static void main(String[] args) throws Exception&#123;\n\n        LazySingleton instance = LazySingleton.getInstance();\n\n        Class&lt;LazySingleton&gt; aClass = LazySingleton.class;\n        Constructor&lt;LazySingleton&gt; constructor = aClass.getDeclaredConstructor();\n        constructor.setAccessible(true);\n        LazySingleton newInstance = constructor.newInstance(null);\n\n        System.out.println(instance);\n        System.out.println(newInstance);\n        System.out.println(instance==newInstance);\n    &#125;\n\nç»“æœä¹Ÿæ˜¯ä¸€æ · ä¸èƒ½é˜²å¾¡åå°„çš„æ”»å‡»ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç»§ç»­åœ¨æ„é€ å‡½æ•°ä¸­ç»§ç»­åˆ¤æ–­ã€‚\n/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/16/23:56\n * æ‡’æ±‰å¼\n */\npublic class LazySingleton implements Serializable &#123;\n\n    private LazySingleton()&#123;\n        if(SINGLETEN!=null)\n            throw new RuntimeException(&quot;å•ä¾‹æ„é€ å™¨ ç¦æ­¢åå°„ç ´å&quot;);\n    &#125;;\n\n    private static volatile LazySingleton SINGLETEN;\n\n    public static LazySingleton getInstance()&#123;\n        if(SINGLETEN==null)&#123;//è¯­å¥1\n            synchronized (LazySingleton.class)&#123;//è¯­å¥2\n                if(SINGLETEN==null)&#123;\n                    SINGLETEN=new LazySingleton();\n                &#125;\n            &#125;\n        &#125;\n        return SINGLETEN;\n    &#125;\n\n    /**\n     * é˜²æ­¢ååºåˆ—åŒ–\n     * @return\n     */\n    private Object readResolve()&#123;\n        return SINGLETEN;\n    &#125;\n&#125;\n\nç»§ç»­è¿è¡Œï¼š\n\nç»“æœä¹Ÿè¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸï¼Œå¯æ˜¯è¿™æ ·çœŸçš„æ²¡ç”¨é—®é¢˜äº†å—ã€‚\næˆ‘ä»¬æ¢ä¸ªæ€è·¯ï¼Œè®©åå°„çš„ä»£ç å…ˆæ‰§è¡Œï¼ŒgetInstance()æ–¹æ³•åæ‰§è¡Œè¯•è¯•ã€‚\n public static void main(String[] args) throws Exception&#123;\n        //åå°„å…ˆæ‰§è¡Œ\n        Class&lt;LazySingleton&gt; aClass = LazySingleton.class;\n        Constructor&lt;LazySingleton&gt; constructor = aClass.getDeclaredConstructor();\n        constructor.setAccessible(true);\n        LazySingleton newInstance = constructor.newInstance(null);\n\n        LazySingleton instance = LazySingleton.getInstance();\n        System.out.println(instance);\n        System.out.println(newInstance);\n        System.out.println(instance==newInstance);\n    &#125;\n\nè¿è¡Œç»“æœï¼š\n\nç»“æœåå°„åˆå†æ¬¡ç ´åäº†æˆ‘ä»¬çš„å•ä¾‹ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å‘¢ã€‚\nä¸»è¦æ˜¯åœ¨æ„é€ å‡½æ•°é‡Œé¢åšåˆ¤æ–­ï¼Œå…¶å®ä¸ç®¡æ€ä¹ˆåšåˆ¤æ–­ï¼Œåå°„éƒ½å¯ä»¥é€šè¿‡æ‰“å¼€ç§æœ‰æƒé™ å»ç ´åã€‚\nå› ä¸ºæ‡’æ±‰å¼æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å»¶è¿ŸåŠ è½½ï¼Œåªæœ‰ç”¨åˆ°æ—¶å€™æ‰ä¼šåŠ è½½ï¼Œé‚£ä¹ˆåªè¦åœ¨åŠ è½½å‰ æ‰§è¡Œåå°„ä»£ç çš„è¯ å°±æ˜¯é¿å…ä¸äº†è¢«ç ´åçš„ã€‚æ‰€ä»¥æˆ‘ä»¬èƒ½åšçš„å°±æ˜¯å°½é‡çš„è®©åå°„çš„ä»£ç åæ‰§è¡Œ ï¼Œåœ¨å¤šçº¿ç¨‹ä¸‹ åŠ è½½çš„ä»£ç  å’Œåå°„ä»£ç æ˜¯ä¸åŒçº¿ç¨‹æ‰§è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•é¿å…ã€‚\nä¸Šé¢çš„é¥¿æ±‰å¼æ˜¯åŠ è½½ç±»é˜¶æ®µçš„æ—¶å€™å°±ä¼šåˆ›å»ºå‡ºï¼Œå³ä½¿å…ˆåå°„ä»£ç å…ˆæ‰§è¡Œï¼Œåå°„ä¹Ÿä¼šè§¦å‘ç±»çš„åŠ è½½ï¼Œä»è€Œå®Œæˆåˆ›å»ºï¼Œ\nåœ¨newInstanceçš„æ—¶å€™ä¹Ÿå°±ä¼šæŠ¥é”™ã€‚è€Œé™æ€å†…éƒ¨ç±»æ˜¯ç”±JVMä¿è¯çš„å®‰å…¨ã€‚\nå°ç»“ï¼šæ‡’æ±‰å¼åªèƒ½é˜²å¾¡ååºåˆ—åŒ–æ”»å‡»ï¼Œä¸èƒ½å®Œå…¨é˜²å¾¡åå°„æ”»å‡»ã€‚\nå®¹å™¨å•ä¾‹ï¼šååºåˆ—åŒ–æ”»å‡»ï¼šå®¹å™¨å•ä¾‹ public static void main(String[] args) throws Exception&#123;\n\n        ContainerSingleton instance = ContainerSingleton.getInstance();\n        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;instance_file&quot;));\n        oos.writeObject(instance);\n\n        File file = new File(&quot;instance_file&quot;);\n        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(file));\n        ContainerSingleton readObject = (ContainerSingleton)ois.readObject();\n\n        System.out.println(instance);\n        System.out.println(readObject);\n        System.out.println(instance==readObject);\n    &#125;\n\nä¹Ÿæ˜¯å’Œå¤§å®¶ä¸€æ ·ï¼Œé˜²å¾¡ä¸äº†åºåˆ—åŒ–æ”»å‡»ï¼Œä¹Ÿæ˜¯è¦æä¾›readResolve()æ–¹æ³•ã€‚\n/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/17/1:54\n * å®¹å™¨å®ç°æ³•\n */\npublic class ContainerSingleton  implements Serializable &#123;\n    private ContainerSingleton()&#123;&#125;;\n\n    private static ConcurrentHashMap&lt;String, ContainerSingleton&gt; map=new ConcurrentHashMap();\n\n    private static String KEY=&quot;singleten&quot;;\n\n    public static ContainerSingleton getInstance()&#123;\n        ContainerSingleton singleten = map.get(KEY);\n        return singleten!=null?singleten:map.computeIfAbsent(KEY,s-&gt; new ContainerSingleton());\n    &#125;\n\n    /**\n     * é˜²æ­¢ååºåˆ—åŒ–\n     * @return\n     */\n    private Object readResolve()&#123;\n        return map.get(KEY);\n    &#125;\n&#125;\n\nåå°„æ”»å‡»ï¼šå®¹å™¨å•ä¾‹ ç»™æ„é€ å‡½æ•°ä¸­æ·»åŠ åˆ¤æ–­ å¹¶è®©åå°„ä»£ç å…ˆæ‰§è¡Œprivate ContainerSingleton()&#123;\n    if(map.get(KEY)!=null)\n      throw new RuntimeException(&quot;å•ä¾‹æ„é€ å™¨ ç¦æ­¢åå°„ç ´å&quot;);\n &#125;;\n\n public static void main(String[] args) throws Exception&#123;\n        //åå°„å…ˆæ‰§è¡Œ\n        Class&lt;ContainerSingleton&gt; aClass = ContainerSingleton.class;\n        Constructor&lt;ContainerSingleton&gt; constructor = aClass.getDeclaredConstructor();\n        constructor.setAccessible(true);\n        ContainerSingleton newInstance = constructor.newInstance(null);\n\n        ContainerSingleton instance = ContainerSingleton.getInstance();\n        System.out.println(instance);\n        System.out.println(newInstance);\n        System.out.println(instance==newInstance);\n    &#125;\n\nè¡¨ç°ç»“æœä¹Ÿæ˜¯å’Œæ‡’æ±‰å¼ä¸€æ ·ï¼Œåªèƒ½é˜²å¾¡ä½ åå°„åæ‰§è¡Œçš„æƒ…å†µï¼Œå¦‚æœåå°„å…ˆæ‰§è¡Œå°±é˜²å¾¡ä¸äº†ã€‚\næšä¸¾å•ä¾‹ï¼šååºåˆ—æ”»å‡»ï¼šæšä¸¾å•ä¾‹ public static void main(String[] args) throws Exception&#123;\n        \n        EnumSingleton instance = EnumSingleton.getInstance();\n        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;instance_file&quot;));\n        oos.writeObject(instance);\n\n        File file = new File(&quot;instance_file&quot;);\n        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(file));\n        EnumSingleton readObject =(EnumSingleton) ois.readObject();\n\n        System.out.println(instance.getData());\n        System.out.println(readObject.getData());\n        System.out.println(instance.getData()==readObject.getData());\n\n    &#125;\n\nè¿è¡Œç»“æœï¼š\n\nåå°„æ”»å‡»ï¼šæšä¸¾å•ä¾‹public static void main(String[] args) throws Exception&#123;\n        //åå°„å…ˆæ‰§è¡Œ\n        Class&lt;EnumSingleton&gt; aClass = EnumSingleton.class;\n        Constructor&lt;EnumSingleton&gt; constructor = aClass.getDeclaredConstructor();\n        constructor.setAccessible(true);\n        EnumSingleton newInstance = constructor.newInstance(null);\n\n        EnumSingleton instance = EnumSingleton.getInstance();\n        System.out.println(instance);\n        System.out.println(newInstance);\n        System.out.println(instance==newInstance);\n\n    &#125;\n\nè¿è¡Œç»“æœï¼š\n\nJavaè§„èŒƒå­—è§„å®šï¼Œæ¯ä¸ªæšä¸¾ç±»å‹åŠå…¶å®šä¹‰çš„æšä¸¾å˜é‡åœ¨JVMä¸­éƒ½æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤åœ¨æšä¸¾ç±»å‹çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¸Šï¼ŒJavaåšäº†ç‰¹æ®Šçš„è§„å®šã€‚åœ¨åºåˆ—åŒ–çš„æ—¶å€™Javaä»…ä»…æ˜¯å°†æšä¸¾å¯¹è±¡çš„nameå±æ€§è¾“åˆ°ç»“æœä¸­ï¼Œååºåˆ—åŒ–çš„æ—¶å€™åˆ™æ˜¯é€šè¿‡java.lang.Enumçš„valueOf()æ–¹æ³•æ¥æ ¹æ®åå­—æŸ¥æ‰¾æšä¸¾å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåºåˆ—åŒ–çš„æ—¶å€™åªå°†DATASOURCEè¿™ä¸ªåç§°è¾“å‡ºï¼Œååºåˆ—åŒ–çš„æ—¶å€™å†é€šè¿‡è¿™ä¸ªåç§°ï¼ŒæŸ¥æ‰¾å¯¹åº”çš„æšä¸¾ç±»å‹ï¼Œå› æ­¤ååºåˆ—åŒ–åçš„å®ä¾‹ä¹Ÿä¼šå’Œä¹‹å‰è¢«åºåˆ—åŒ–çš„å¯¹è±¡å®ä¾‹ç›¸åŒã€‚\næ€»ç»“ï¼šæšä¸¾å•ä¾‹ å¤©ç„¶çš„é˜²å¾¡ååºåˆ—åŒ–å’Œåå°„æ”»å‡»ï¼Œé¥¿æ±‰å¼å’Œé™æ€å†…éƒ¨ç±»ä¹Ÿå¯ä»¥é˜²å¾¡ éœ€è¦æä¾›readResolve()æ–¹æ³•å’Œå¯¹æ„é€ å‡½æ•°åˆ¤æ–­ï¼Œæ‡’æ±‰å¼å’Œå®¹å™¨å•ä¾‹ å¯ä»¥é˜²å¾¡ååºåˆ—åŒ–æ”»å‡»ï¼Œä½†ä¸èƒ½å®Œå…¨é˜²å¾¡åå°„æ”»å‡»ã€‚ä»£ç åœ°å€\n","tags":["è®¾è®¡æ¨¡å¼"]}]