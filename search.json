[{"title":"åˆ©ç”¨åå°„+è‡ªå®šä¹‰æ³¨è§£ å®ç°å„ç§Beanä¹‹é—´çš„è½»æ¾è½¬æ¢","url":"/2021/10/26/demo2/","content":"Beanè½¬æ¢å·¥å…·ç±»é»˜è®¤æŒ‰ç…§å­—åˆ—åç›¸åŒè½¬æ¢ ä¸åŒæ—¶é€šè¿‡@Copyæ³¨è§£æŒ‡å®šåˆ—å\nCopyUtilsç±»ï¼šæä¾›Beanè½¬æ¢æ–¹æ³•\n@Copyæ³¨è§£ï¼š ç”¨äºæ˜ å°„åˆ—åä¸ä¸€æ ·\n@Excludeæ³¨è§£ï¼šç”¨äºå–æ¶ˆå­—æ®µçš„æ˜ å°„ é»˜è®¤ä¸ºtrue\n\nApiè¯´æ˜ï¼š\nå•ä¸ªBeanè½¬æ¢ :  T copy(Object source,Class targetClass)\nå¤šä¸ªBeanè½¬æ¢ : List copy(List sourceList,Class targetClass)\nmapè½¬Bean   :  T toBean(Map&lt;String,Object&gt; map,Class targetClass)\nBeanè½¬Map   :  Map&lt;String,Object&gt; toMap(Object target)\n\næ³¨è§£ç”¨æ³•   @Data\n   public class User &#123;\n    \n    private String name;\n    \n    private Integer age;\n    \n   &#125;\n \n   @Data\n   @Builder\n   public class UserVo &#123;\n    \n    @Copy(&quot;name&quot;)//æŒ‡å®šè¦è½¬æ¢çš„åˆ—å\n    private String nameVo;\n    \n    private Integer age;\n    \n    @Exclude//æ’é™¤è¯¥å­—æ®µ é»˜è®¤ä¸ºtrue\n    private String sex;\n    \n   &#125;\n   \n\nğŸ‘‰ğŸ»å¿«é€Ÿå¼€å§‹   public static void main(String[] args) &#123;\n        \n        //å•ä¸ªBeanè½¬æ¢\n        UserVo userVo = UserVo.builder().nameVo(&quot;å°çƒæŸ&quot;).age(3).sex(&quot;ç”·&quot;).build();\n        User user = CopyUtils.copy(userVo, User.class);\n        \n        //å¤šä¸ªBeanè½¬æ¢\n        UserVo userVo1 = UserVo.builder().nameVo(&quot;å¼ ä¸‰&quot;).age(18).sex(&quot;ç”·&quot;).build();\n        UserVo userVo2 = UserVo.builder().nameVo(&quot;æå››&quot;).age(22).sex(&quot;ç”·&quot;).build();\n        List&lt;UserVo&gt; userVoList = Arrays.asList(userVo1, userVo2);\n        List&lt;User&gt; userList = CopyUtils.copy(userVoList, User.class);\n        \n        //mapè½¬Bean\n        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();\n        map.put(&quot;name&quot;,&quot;å°çƒæŸ&quot;);\n        map.put(&quot;age&quot;,20);\n        User user = CopyUtils.toBean(map, User.class);\n        \n        //Beanè½¬Map\n        Map&lt;String, Object&gt; map = CopyUtils.toMap(user);\n    &#125;\n   \n\nå¥½ç”¨çš„åŒå­¦ğŸ’ğŸ» ç‚¹ä¸ªæ˜Ÿå‘—åœ°å€\n","tags":["java"]},{"title":"è®¾è®¡æ¨¡å¼ä¹‹å»ºé€ è€…æ¨¡å¼","url":"/2021/10/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F/","content":"ä»‹ç»ï¼šå»ºé€ è€…æ¨¡å¼çš„å®šä¹‰æ˜¯ï¼šå°†å¤æ‚å¯¹è±¡çš„æ„é€ ä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºï¼Œè¿™æ ·çš„è®¾è®¡æ¨¡å¼è¢«ç§°ä¸ºå»ºé€ è€…æ¨¡å¼ã€‚\nä¸ºä»€ä¹ˆä½¿ç”¨æ„å»ºè€…æ¨¡å¼ï¼Ÿä»€ä¹ˆåœºæ™¯ä½¿ç”¨æ„å»ºè€…æ¨¡å¼ï¼Ÿ\nå‡å¦‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå¯¹è±¡çš„åˆ›å»ºéå¸¸çš„å¤æ‚ï¼Œå¯¹è±¡ä¸­è¿˜è¦å¯¹è±¡çš„å°è£…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ„å»ºè€…æ¨¡å¼ï¼Œå°†è¯¥å¯¹è±¡çš„æ„å»ºäº¤ç»™å®ƒæ¥å¤„ç†ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™æ‰¾ä»–è¦ä¸€ä¸ªå¯¹è±¡å°±å¯ä»¥äº†ã€‚\n\nå‡å¦‚ç°åœ¨æœ‰ä¸ªUserç±»å¦‚ä¸‹/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/10/27/17:48\n */\n@Data\npublic class User &#123;\n\n    private String name;\n    private int age;\n    private String sex;\n    private String phone;\n    private String address;\n\n&#125;    \n\nå½“æˆ‘ä»¬è¦æ„å»ºnameå­—æ®µå’Œageå­—æ®µæ—¶ æˆ‘ä»¬å¯ä»¥è¿™æ ·\npublic User(String name, int age) &#123;\n        this.name = name;\n        this.age = age;\n&#125;\n\nåŒç†å½“éœ€è¦æ„å»º nameå­—æ®µ ageå­—æ®µ  sexå­—æ®µæ—¶\npublic User(String name, int age, String sex) &#123;\n        this.name = name;\n        this.age = age;\n        this.sex = sex;\n&#125;\n\nå½“æˆ‘ä»¬æ¯æ¬¡éœ€è¦æ„é…ä¸åŒå¯¹è±¡æ—¶ï¼Œå°±è¦ä¸ºè¿™äº›å­—æ®µç”Ÿæˆä¸åŒçš„æ„é€ å‡½æ•°ï¼Œå¦‚æ­¤ä¸€æ¥ æˆ‘ä»¬çš„æ„é€ å‡½æ•°å°±ç‰¹åˆ«å¤š\nå¹¶ä¸”é˜…è¯»æ€§ä¹Ÿç‰¹åˆ«çš„ä¸å¥½ã€‚\nå½“ç„¶è¿˜æœ‰ä¸€ç§è§£å†³åŠæ³• å°±æ˜¯ç”Ÿæˆ get setæ–¹æ³•   public void setName(String name) &#123;\n        this.name = name;\n    &#125;\n\n    public void setAge(int age) &#123;\n        this.age = age;\n    &#125;\n\n    public void setSex(String sex) &#123;\n        this.sex = sex;\n    &#125;\n\n    public void setPhone(String phone) &#123;\n        this.phone = phone;\n    &#125;\n\n    public void setAddress(String address) &#123;\n        this.address = address;\n    &#125;\n\nå†™çš„æ—¶å€™è¿™æ ·å°±å¯ä»¥äº†\npublic static void main(String[] args) &#123;\n      User user=new User();\n      user.setName(&quot;å°çƒæŸ&quot;);\n      user.setAge(20);\n      user.setSex(&quot;ç”·&quot;);\n&#125;\n\nè¿™æ ·ä¸€æ¥å°±ç—›è‹¦çš„æ˜¯æˆ‘ä»¬ç¨‹åºå‘˜äº† è¿™ä¸ªæ—¶å€™æ„å»ºè€…å°±æ¥äº†\né¦–å…ˆæ¥ä¸ªé™æ€å†…éƒ¨ç±» å­—æ®µå’ŒUserç±»ä¿æŒä¸€è‡´/**\n     * å†…éƒ¨ç±»\n     */\n    public static class builder&#123;\n    \n        private String name;\n        private int age;\n        private String sex;\n        private String phone;\n        private String address;\n\n    &#125;\n\næä¾›æ„å»ºå„ä¸ªå­—æ®µçš„æ–¹æ³•     public builder name(String name)&#123;\n         this.name=name;\n         return this;\n     &#125;\n\n     public builder age(int age)&#123;\n         this.age=age;\n         return this;\n     &#125;\n\n     public builder sex(String sex)&#123;\n         this.sex=sex;\n         return this;\n     &#125;\n\n     public builder phone(String phone)&#123;\n         this.phone=phone;\n         return this;\n     &#125;\n\n     public builder address(String address)&#123;\n         this.address=address;\n         return this;\n     &#125;\n\næœ€åæä¾›æ„å»ºbuildæ–¹æ³• åŒæ—¶åœ¨Useræä¾›æ„é€ å‡½æ•°public User build()&#123;\n   return new User(this);\n&#125;\n\npublic User(builder builder)&#123;\n        this.name= builder.name;\n        this.age= builder.age;\n        this.sex= builder.sex;\n        this.phone= builder.phone;\n        this.address= builder.address;\n &#125;\n\nå®Œæ•´ä»£ç /**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/10/27/17:48\n */\n@Data\npublic class User &#123;\n\n    private String name;\n    private int age;\n    private String sex;\n    private String phone;\n    private String address;\n\n\n    public User() &#123;\n    &#125;\n\n    public User(builder builder)&#123;\n        this.name= builder.name;\n        this.age= builder.age;\n        this.sex= builder.sex;\n        this.phone= builder.phone;\n        this.address= builder.address;\n    &#125;\n\n    /**\n     * å†…éƒ¨ç±»\n     */\n    public static class builder&#123;\n    \n        private String name;\n        private int age;\n        private String sex;\n        private String phone;\n        private String address;\n\n        public builder name(String name)&#123;\n            this.name=name;\n            return this;\n        &#125;\n\n        public builder age(int age)&#123;\n            this.age=age;\n            return this;\n        &#125;\n\n        public builder sex(String sex)&#123;\n            this.sex=sex;\n            return this;\n        &#125;\n\n        public builder phone(String phone)&#123;\n            this.phone=phone;\n            return this;\n        &#125;\n\n        public builder address(String address)&#123;\n            this.address=address;\n            return this;\n        &#125;\n\n        public User build()&#123;\n            return new User(this);\n        &#125;\n\n    &#125;\n&#125;\n\nç”¨æ³•public static void main(String[] args) &#123;\n        User user1 = new User.builder().name(&quot;å°çƒæŸ&quot;).age(20).build();\n        User user2 = new User.builder().name(&quot;å°çƒæŸ&quot;).age(20).sex(&quot;ç”·&quot;).build();\n        System.out.println(user1);\n        System.out.println(user2);\n&#125;\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\nUser(name=å°çƒæŸ, age=20, sex=null, phone=null, address=null)\nUser(name=å°çƒæŸ, age=20, sex=ç”·, phone=null, address=null)\n\nç»ˆææ–¹æ³•ï¼šlombokçš„Builderæ³¨è§£@Data\n@Builder\n@AllArgsConstructor\n@NoArgsConstructor\npublic class User &#123;\n\n    private String name;\n    private int age;\n    private String sex;\n    private String phone;\n    private String address;\n    \n&#125;\n\nç”¨æ³• public static void main(String[] args) &#123;\n        User user = User.builder().name(&quot;å°çƒæŸ&quot;).age(20).sex(&quot;ç”·&quot;).build();\n        System.out.println(user);\n &#125;\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\nUser(name=å°çƒæŸ, age=20, sex=ç”·, phone=null, address=null)\n\n","tags":["è®¾è®¡æ¨¡å¼"]},{"title":"ç®€å•å®ç°å•ç‚¹ç™»å½•","url":"/2021/10/31/SSO-%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/","content":"ä»€ä¹ˆæ˜¯å•ç‚¹ç™»é™† ï¼Ÿ\nç”¨ç®€å•çš„è¯æ¥è®²å°±æ˜¯ å¤šä¸ªç³»ç»Ÿ  ä¸€å¤„ç™»é™† å¤„å¤„ç™»é™†\nåˆ›å»ºé¡¹ç›®mavené¡¹ç›®\nè®¤è¯ä¸­å¿ƒ\næœåŠ¡ä¸€\næœåŠ¡äºŒ\n\n\næ‰€æœ‰æ¨¡å—å¼•å…¥ä»¥ä¸‹ä¾èµ–\n &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;!--thymeleaf--&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;!--redisç¼“å­˜å¼•å…¥ --&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;\n        &lt;/dependency&gt;\n        &lt;!--lombok--&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;\n            &lt;artifactId&gt;lombok&lt;/artifactId&gt;\n            &lt;version&gt;1.16.20&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;!--fastjson--&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;\n            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;\n            &lt;version&gt;1.2.41&lt;/version&gt;\n        &lt;/dependency&gt;\n &lt;/dependencies&gt;\n\nè®¤è¯ä¸­å¿ƒé…ç½®å¦‚ä¸‹ï¼š\n# åº”ç”¨åç§°\nspring.application.name=attestation\nserver.port=8000\n\n# RedisæœåŠ¡å™¨åœ°å€\nspring.redis.host=127.0.0.1\n# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£\nspring.redis.port=6379\n\nclient1é…ç½®å¦‚ä¸‹ï¼š\n# åº”ç”¨åç§°\nspring.application.name=client1\nserver.port=8100\n\n# RedisæœåŠ¡å™¨åœ°å€\nspring.redis.host=127.0.0.1\n# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£\nspring.redis.port=6379\n\nclient2é…ç½®å¦‚ä¸‹ï¼š\n# åº”ç”¨åç§°\nspring.application.name=client2\nserver.port=8200\n\n# RedisæœåŠ¡å™¨åœ°å€\nspring.redis.host=127.0.0.1\n# RedisæœåŠ¡å™¨è¿æ¥ç«¯å£\nspring.redis.port=6379\n\n\nä¸ºäº†æ¼”ç¤ºä¸åŒåŸŸåä¹‹é—´çš„ç™»å½• ä¿®æ”¹æœ¬åœ°hostsæ–‡ä»¶ï¼ˆæ–‡ä»¶ç›®å½•åœ¨C:\\Windows\\System32\\drivers\\etcï¼‰\n127.0.0.1 attestation.com\n\n127.0.0.1 client1\n\n127.0.0.1 client2\n\nåœ¨client1ä¸­  ç¼–å†™è®¤è¯æˆåŠŸåæ‰èƒ½è®¿é—®çš„é¡µé¢\n&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;UTF-8&quot;&gt;\n    &lt;title&gt;Title&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;SSO-æœåŠ¡ä¸€ è®¤è¯æˆåŠŸ&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\nåœ¨client1ç¼–å†™ä¸€ä¸ªç®€å•çš„Controller\n/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/10/31/0:03\n */\n@Controller\npublic class indexnController &#123;\n\n    @GetMapping(&quot;list&quot;)\n    public String list()&#123;\n        return &quot;list&quot;;\n    &#125;\n\n&#125;\n\né€šè¿‡æµè§ˆå™¨ è®¿é—®ï¼šhttp://client1:8100/list  ç»“æœå¦‚ä¸‹\n\nè¿™ä¸ªæ—¶å€™å°±è¦ç¼–å†™æˆ‘ä»¬çš„è®¤è¯é€»è¾‘ ï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦ç™»å½•ã€‚\næ­£å¸¸é€šè¿‡sessionæ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½• ï¼Œç™»å½•æ­£å¸¸è®¿é—®ï¼Œæœªç™»å½•å°±é‡å®šå‘åˆ°æˆ‘ä»¬çš„è®¤è¯ä¸­å¿ƒå»ã€‚\nç¼–å†™è®¤è¯ä¸­å¿ƒ ç™»å½•é¡µé¢å’ŒController&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;UTF-8&quot;&gt;\n    &lt;title&gt;Title&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;h1&gt;SSO-è®¤è¯ä¸­å¿ƒ&lt;/h1&gt;\n&lt;form method=&quot;post&quot; action=&quot;&quot;&gt;\n    è´¦å·ï¼š&lt;input name=&quot;userName&quot; type=&quot;text&quot;&gt;&lt;br&gt;\n    å¯†ç ï¼š&lt;input name=&quot;password&quot; type=&quot;text&quot;&gt;&lt;br&gt;\n    ç™»é™† &lt;input type=&quot;submit&quot;&gt;\n    &lt;input type=&quot;hidden&quot; name=&quot;url&quot;&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\n@Controller\npublic class LoginController &#123;\n\n    /**\n     * è·³è½¬åˆ°ç™»å½•è§†å›¾\n     * @return\n     */\n    @GetMapping(&quot;login.html&quot;)\n    public String loginPage()&#123;\n        return &quot;login&quot;;\n    &#125;\n\n    /**\n     * å¤„ç†ç™»å½•é€»è¾‘\n     * @param user\n     * @return\n     */\n    @PostMapping(&quot;doLogin&quot;)\n    public String dolgoin(User user)&#123;\n        return null;\n    &#125;\n\n&#125;\n\n  @Data\n  public class User implements Serializable&#123;\n     private String userName;\n     private String password;\n  &#125;\n\nclient1ä»£ç  æ”¹åŠ¨å¦‚ä¸‹ï¼š\n    @GetMapping(&quot;list&quot;)\n    public String list(HttpSession session)&#123;\n        if(session.getAttribute(&quot;loginUser&quot;)==null)\n            return &quot;redirect:http://attestation.com:8000/login.html&quot;;\n        return &quot;list&quot;;\n    &#125;\n\nè¯·æ±‚æµç¨‹å˜æˆè¿™æ ·ï¼š\nclient1:8100/list â€”-ã€‹attestation.com:8000/login.html  â€”-ã€‹ç™»å½•è®¤è¯å  â€”-ã€‹attestation.com:8000/doLogin\né‚£ä¹ˆé—®é¢˜æ¥äº† å½“è®¤è¯ä¸­å¿ƒçš„dolgoinè¯·æ±‚å¤„ç†å®Œæˆä»¥å è¦è·³è½¬åˆ°é‚£é‡Œå»å‘¢ï¼Ÿ\næ­£å¸¸åº”è¯¥æ˜¯è·³è½¬åˆ°client1:8100/list ä¸­å» é‚£ä¹ˆæ€ä¹ˆæ‰èƒ½æ­£å¸¸è·³è½¬ã€‚\nå¯ä»¥åœ¨client1ä¸­è·³è½¬login.htmlè¯·æ±‚çš„æ—¶å€™æºå¸¦ä¸€ä¸ªredirect_ur1å‚æ•°ï¼Œlogin.htmlè¯·æ±‚æ¥æ”¶è¿™ä¸ªURLï¼Œå¹¶å°†è¿™ä¸ªå‚æ•°éšè—åœ¨å‰ç«¯ï¼Œ æäº¤dolgoinè¯·æ±‚çš„æ—¶å€™ä¼ é€’è¿™ä¸ªURLå³å¯ã€‚client1ä¸­ä»£ç æ”¹åŠ¨å¦‚ä¸‹ï¼š\n @GetMapping(&quot;list&quot;)\n    public String list(HttpSession session)&#123;\n        if(session.getAttribute(&quot;loginUser&quot;)==null)\n            return &quot;redirect:http://attestation.com:8000/login.html?redirect_ur1=http://client1:8100/list&quot;;\n        return &quot;list&quot;;\n    &#125;\n\nloginè¯·æ±‚æ”¹åŠ¨å¦‚ä¸‹ï¼š\n    @GetMapping(&quot;login.html&quot;)\n    public String loginPage(@RequestParam(&quot;redirect_ur1&quot;) String url, Model model)&#123;\n        model.addAttribute(&quot;url&quot;,url);\n        return &quot;login&quot;;\n    &#125;\n\né¡µé¢æ”¹åŠ¨å¦‚ä¸‹ï¼š\n&lt;form method=&quot;post&quot; action=&quot;doLogin&quot;&gt;\n    è´¦å·ï¼š&lt;input name=&quot;userName&quot; type=&quot;text&quot;&gt;&lt;br&gt;\n    å¯†ç ï¼š&lt;input name=&quot;password&quot; type=&quot;text&quot;&gt;&lt;br&gt;\n    &lt;input type=&quot;hidden&quot; name=&quot;url&quot; th:value=&quot;$&#123;url&#125;&quot;&gt;\n    ç™»é™† &lt;input type=&quot;submit&quot;&gt;\n&lt;/form&gt;\n\nä¸ºäº†æ–¹ä¾¿å°±å°†URLè¿™ä¸ªå‚æ•°æ·»åŠ åˆ°Userä¸­å»\n  @Data\n  public class User implements Serializable&#123;\n     private String userName;\n     private String password;\n     private String url;\n  &#125;\n\nè¿™ä¸ªæ—¶å€™dolgoinè¯·æ±‚å°±å¯ä»¥æ­£å¸¸çš„è·³è½¬å›å»äº†\n    @PostMapping(&quot;doLogin&quot;)\n    public String dolgoin(User user, HttpSession session)&#123;\n        session.setAttribute(&quot;loginUser&quot;,user);\n        return &quot;redirect:&quot;+user.getUrl();\n    &#125;\n\næ”¹åŠ¨å®Œä»£ç ä»¥å å¹¶ç™»é™†åè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n\næ˜æ˜ç™»é™†äº† ä¸ºä»€ä¹ˆè¿˜æ˜¯ä¼šè·³è½¬åˆ°è®¤è¯ä¸­å¿ƒå‘¢åŸå› å¦‚ä¸‹ï¼šåœ¨listè¯·æ±‚ä¸­æˆ‘ä»¬æ˜¯é€šè¿‡sessionæ¥åˆ¤æ–­æ˜¯å¦ç™»å½•ï¼Œ è™½ç„¶åœ¨è®¤è¯ä¸­å¿ƒç™»å½•ï¼Œ ä½†è®¤è¯ä¸­å¿ƒå­˜çš„session\n client1æ˜¯å–ä¸åˆ°  æ‰€ä»¥å°±ä¼šé‡æ–°è·³è½¬åˆ°è®¤è¯ä¸­å¿ƒå»ã€‚\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥æ¢ä¸€ä¸ªæ€è·¯ï¼Œå°†è®¤è¯ä¸­å¿ƒå­˜æ”¾çš„session æ”¾å…¥Redisä¸­å¹¶å°†å­˜å…¥æ—¶æ”¾çš„key åœ¨é‡å®šå‘çš„æ—¶å€™æºå¸¦ç»™client1 ï¼Œ client1 ä¸­æ¥æ”¶è¿™ä¸ªkeyæ¥åˆ¤æ–­å³å¯ã€‚è®¤è¯ä¸­å¿ƒä»£ç å˜åŒ–å¦‚ä¸‹ï¼š    @Resource\n    private RedisTemplate redisTemplate;\n\n    @PostMapping(&quot;doLogin&quot;)\n    public String dolgoin(User user)&#123;\n        String token= UUID.randomUUID().toString().replace(&quot;-&quot;,&quot;&quot;);\n        redisTemplate.opsForValue().set(token,JSON.toJSONString(user),30, TimeUnit.MINUTES);\n        return &quot;redirect:&quot;+user.getUrl()+&quot;?token=&quot;+token;\n    &#125;\n\nclient1ä»£ç å˜åŒ–å¦‚ä¸‹ï¼š    @Resource\n    private RedisTemplate redisTemplate;\n\n    @GetMapping(&quot;list&quot;)\n    public String list(@RequestParam(value = &quot;token&quot;,required = false) String token, HttpSession session)&#123;\n        if(!StringUtils.isEmpty(token))&#123;\n            String json = (String) redisTemplate.opsForValue().get(token);\n            User loginUser = JSON.parseObject(json, User.class);\n            if(loginUser!=null)\n                session.setAttribute(&quot;loginUser&quot;,loginUser);\n        &#125;\n        if(session.getAttribute(&quot;loginUser&quot;)==null)\n            return &quot;redirect:http://attestation.com:8000/login.html?redirect_ur1=http://client1:8100/list&quot;;\n        return &quot;list&quot;;\n    &#125;\n\nä¸ºäº†çœ‹åˆ°è®¤è¯åçš„æ•ˆæœ ä¿®æ”¹client1ä¸­HTMLä»£ç \n&lt;body&gt;\n&lt;h1&gt;SSO-æœåŠ¡ä¸€ è®¤è¯æˆåŠŸ&lt;/h1&gt;\n&lt;h1&gt;ç™»å½•ä¿¡æ¯å¦‚ä¸‹&lt;/h1&gt;\n&lt;h1 th:text=&quot;$&#123;session.loginUser==null?&#39;è´¦å·ï¼šæœªç™»å½•&#39;:&#39;è´¦å·ï¼š&#39;+session.loginUser.userName&#125;&quot;&gt;&lt;/h1&gt;\n&lt;h1 th:text=&quot;$&#123;session.loginUser==null?&#39;å¯†ç ï¼šæœªç™»å½•&#39;:&#39;å¯†ç ï¼š&#39;+session.loginUser.password&#125;&quot;&gt;&lt;/h1&gt;\n&lt;/body&gt;\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼šè®¿é—®http://client1:8100/list \n\næ­£å¸¸è·³è½¬åˆ°è®¤è¯ä¸­å¿ƒ ç™»å½•å æ­£å¸¸æ˜¾ç¤º\n\nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æŠŠclient1ä»£ç å¤åˆ¶ç»™client2ï¼Œå¹¶ä¿®æ”¹é‡å®šå‘redirect_ur1å‚æ•°å˜æˆclient2çš„åœ°å€\n@GetMapping(&quot;list&quot;)\n    public String list(@RequestParam(value = &quot;token&quot;,required = false) String token, HttpSession session)&#123;\n        if(!StringUtils.isEmpty(token))&#123;\n            String json = (String) redisTemplate.opsForValue().get(token);\n            User loginUser = JSON.parseObject(json, User.class);\n            if(loginUser!=null)\n                session.setAttribute(&quot;loginUser&quot;,loginUser);\n        &#125;\n        if(session.getAttribute(&quot;loginUser&quot;)==null)\n            return &quot;redirect:http://attestation.com:8000/login.html?redirect_ur1=http://client2:8200/list&quot;;\n        return &quot;list&quot;;\n    &#125;\n\n å¯åŠ¨èµ·æ¥ è®¿é—®ï¼šhttp://client2:8200/list\n\nä¸ºä»€ä¹ˆæ˜¯è¿˜æ˜¯ä¼šè·³è½¬åˆ°è®¤è¯ä¸­å¿ƒå» åœ¨client1ä¸­ä¸æ˜¯ç™»å½•äº†å—åˆ†æä»£ç ï¼šé¦–å…ˆä¼šåˆ¤æ–­token æˆ‘ä»¬æ²¡æœ‰token ç„¶åä¼šåˆ¤æ–­session è¿™ä¸ªæ—¶å€™ä¹Ÿæ²¡æœ‰ æ‰€ä»¥ä¼šé‡å®šå‘åˆ°è®¤è¯ä¸­å¿ƒå» \nè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨dolgoinè¯·æ±‚ç™»å½•åï¼Œåœ¨å­˜å…¥Redisçš„åŒæ—¶ï¼Œåœ¨Cookieä¸­ä¹ŸåŒæ—¶ä¿å­˜ä¸€ä»½ä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨loginPageè¯·æ±‚ä¸­åˆ¤æ–­æ˜¯å¦æœ‰Cookie å¦‚æœæœ‰åˆ™è¯æ˜æœ‰äººç™»å½•è¿‡ ç›´æ¥è·³è½¬å›å»å³å¯ã€‚è®¤è¯ä¸­å¿ƒä»£ç å˜åŒ–å¦‚ä¸‹ï¼š\n   /**\n     * å¤„ç†ç™»å½•è¯·æ±‚\n     * @param user\n     * @param response\n     * @return\n     */\n    @PostMapping(&quot;doLogin&quot;)\n    public String dolgoin(User user, HttpServletResponse response)&#123;\n        String token= UUID.randomUUID().toString().replace(&quot;-&quot;,&quot;&quot;);\n        redisTemplate.opsForValue().set(token,JSON.toJSONString(user),30, TimeUnit.MINUTES);\n        Cookie cookie = new Cookie(&quot;sso_token&quot;, token);\n        response.addCookie(cookie);\n        return &quot;redirect:&quot;+user.getUrl()+&quot;?token=&quot;+token;\n    &#125;\n\n    /**\n     * è·³è½¬åˆ°ç™»å½•è§†å›¾\n     * @param url\n     * @param model \n     * @param token  \n     * @return\n     */\n    @GetMapping(&quot;login.html&quot;)\n    public String loginPage(@RequestParam(&quot;redirect_ur1&quot;) String url, Model model,\n                            @CookieValue(value = &quot;sso_token&quot;,required = false) String token)&#123;\n        if(!StringUtils.isEmpty(token))&#123;\n            return &quot;redirect:&quot;+url+&quot;?token=&quot;+token;\n        &#125;\n        model.addAttribute(&quot;url&quot;,url);\n        return &quot;login&quot;;\n    &#125;\n\næœ€åè¿è¡Œclient2 è®¿é—®ï¼šhttp://client2:8200/list\n\nâ€‹     ä»£ç åœ°å€ï¼šhttps://github.com/huangjie-qq/sso\n","tags":["java"]},{"title":"ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å¼","url":"/2021/11/05/%E7%94%9F%E6%88%90%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%BC%8F/","content":"ä¸€æ­¥ä¸€æ­¥èµ°è¿›ç”Ÿäº§æ¶ˆè´¹è€…é¦–æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ™®é€šjavaå·¥ç¨‹\nå®šä¹‰ä¸€ä¸ªå®ç°ç±» å®ç°ç”Ÿäº§æ–¹æ³•å’Œæ¶ˆè´¹æ–¹æ³• \nä¸ºäº†ç®€å• æˆ‘ä»¬å°±ç”¨ä½¿ç”¨æ™®é€šçš„synchronizedé”å’Œ  booleanå˜é‡æ¥åˆ¤æ–­æ˜¯å¦ç”Ÿäº§æ¶ˆè´¹ \n/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/06/0:01\n */\npublic class Realization &#123;\n    private Object lock;//é”\n    private boolean sign=true;//trueç”Ÿäº§ falseæ¶ˆè´¹ çœ‹å¥½è¿™ä¸ªçŠ¶æ€ä½ ä¸‹é¢å¾ˆé‡è¦\n\n    public Realization(Object lock) &#123;\n        this.lock = lock;\n    &#125;\n&#125;\n\nç¼–å†™ç”Ÿäº§æ–¹æ³•   /**\n     *ç”Ÿäº§æ–¹æ³•\n     */\n    public void producer()&#123;\n        synchronized (lock)&#123;\n            try&#123;\n                if(!sign)\n                    lock.wait();\n                System.out.println(Thread.currentThread().getName()+&quot; ç”Ÿäº§&quot;);\n                sign=false;\n                lock.notify();\n            &#125;catch (InterruptedException e)&#123;\n                e.printStackTrace();\n            &#125;\n        &#125;\n    &#125;\n\nç¼–å†™æ¶ˆè´¹è€…æ–¹æ³•   /**\n     * æ¶ˆè´¹æ–¹æ³•\n     */\n    public void consumer()&#123;\n        synchronized (lock)&#123;\n            try&#123;\n                if(sign)\n                    lock.wait();\n                System.out.println(Thread.currentThread().getName()+&quot; æ¶ˆè´¹&quot;);\n                sign=true;\n                lock.notify();\n            &#125;catch (InterruptedException e)&#123;\n                e.printStackTrace();\n            &#125;\n        &#125;\n    &#125;\n\nç¼–å†™ç”Ÿäº§è€…/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/06/00:16\n * ç”Ÿäº§è€…\n */\npublic class Producer implements Runnable&#123;\n    private Realization realization;\n    \n    public Producer(Realization realization) &#123;\n        this.realization = realization;\n    &#125;\n    \n    @Override\n    public void run() &#123;\n        while (true)&#123;\n            realization.producer();\n        &#125;\n    &#125;\n&#125;\n\nç¼–å†™æ¶ˆè´¹è€…/**\n * @Authorï¼šå°çƒæŸ\n * @Dateï¼š2021/11/06/00:19\n * æ¶ˆè´¹è€…\n */\npublic class Consumer implements Runnable&#123;\n    private Realization realization;\n\n    public Consumer(Realization realization) &#123;\n        this.realization = realization;\n    &#125;\n    \n    @Override\n    public void run() &#123;\n       while (true)&#123;\n           realization.consumer();\n       &#125;   \n    &#125;\n&#125;\n\næœ€åç¼–å†™Mainæµ‹è¯•public static void main(String[] args) &#123;\n\n    Realization realization = new Realization(new Object());\n\n    Producer producer = new Producer(realization);\n    Consumer consumer = new Consumer(realization);\n\n    new Thread(producer,&quot;ç”Ÿäº§è€…&quot;).start();\n    new Thread(consumer,&quot;æ¶ˆè´¹è€…&quot;).start();\n&#125;\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n\nè¿è¡Œç»“æœä¹Ÿä¸é”™ ç”Ÿäº§ä¸€ä¸ªæ¶ˆè´¹å¤šä¸ª æ²¡æœ‰ä»€ä¹ˆé—®é¢˜\nä½†æˆ‘ä»¬å®é™…ä½¿ç”¨ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼çš„æ—¶å€™ä¸€èˆ¬æ˜¯ä¼šå¤šä¸ªç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…\nè¿™ä¸ªæˆ‘ä»¬å¼€å¯å¤šä¸ªç”Ÿäº§è€…å’Œå¤šä¸ªæ¶ˆè´¹è€… è¯•ä¸€è¯•æˆ‘ä»¬çš„ä»£ç \npublic static void main(String[] args) &#123;\n\n        Realization realization = new Realization(new Object());\n\n        Producer producer = new Producer(realization);\n        Consumer consumer = new Consumer(realization);\n\n        new Thread(producer,&quot;ç”Ÿäº§è€…-1å·&quot;).start();\n        new Thread(producer,&quot;ç”Ÿäº§è€…-2å·&quot;).start();\n        new Thread(consumer,&quot;æ¶ˆè´¹è€…-1å·&quot;).start();\n        new Thread(consumer,&quot;æ¶ˆè´¹è€…-2å·&quot;).start();\n    &#125;\n\nè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n\nä¸ºä»€ä¹ˆä¼šè¿™ç§ ç”Ÿäº§ä¸€ä¸ª æ¶ˆè´¹ä¸¤æ¬¡çš„æƒ…å†µå‘¢ï¼Ÿ\næ¥çœ‹æ ¸å¿ƒä»£ç ï¼š\n1   if(sign)\n2       lock.wait();\n3   System.out.println(Thread.currentThread().getName()+&quot; æ¶ˆè´¹&quot;);\n4   sign=true;\n5   lock.notify();\n\nä¸Šé¢çš„booleanæ ‡è®°æ˜¯é»˜è®¤æ˜¯trueï¼Œæ‰€ä»¥æ˜¯è¦å…ˆç”Ÿäº§ åæ¶ˆè´¹\nç°åœ¨æˆ‘ä»¬æ¥æ¨¡æ‹Ÿ åˆšåˆšå‘é€çš„æƒ…å†µçš„è¿™ç§æƒ…å†µç”Ÿäº§è€…:t1 t2 æ¶ˆè´¹è€…ï¼št3 t41æ­¥ï¼š t3å¾—åˆ°è°ƒåº¦ åˆ¤æ–­If  ä¸º  true  t3ä¼‘çœ   ï¼ˆä¼‘çœ ï¼št3   çŠ¶æ€ä½ï¼štrueï¼‰\n2æ­¥ï¼šæ°å·§t4ä¹Ÿå¾—åˆ°è°ƒåº¦ å’Œt3ä¸€æ ·ä¼‘çœ  ï¼ˆä¼‘çœ ï¼št3  t4   çŠ¶æ€ä½ï¼štrueï¼‰\n3æ­¥ï¼št1å¾—åˆ°è°ƒåº¦ é¦–å…ˆåˆ¤æ–­if è¦ç”Ÿäº§ä¸€ä¸ªæ¶ˆæ¯ ç„¶åæ”¹å˜çŠ¶æ€ä½ ç”¨notify å”¤é†’äº†t3  (ä¼‘çœ ï¼št4   çŠ¶æ€ä½ï¼šfalse)\n4æ­¥ï¼št3å¾—åˆ°è°ƒåº¦ ä»ç¬¬2è¡Œä»£ç é†’æ¥çš„t3 ä¼šæ¥ç€å¾€ä¸‹æ‰§è¡Œ3 4è¡Œä»£ç  å¹¶æ”¹å˜çŠ¶æ€ä½  å”¤é†’çš„äººæ˜¯t4 (çŠ¶æ€ä½ï¼štrue)\n5æ­¥ï¼št4å¾—åˆ°è°ƒåº¦  ä»ç¬¬2è¡Œä»£ç é†’æ¥çš„t4   ä¼šæ¥ç€å¾€ä¸‹æ‰§è¡Œ3 4è¡Œä»£ç  æ”¹å˜çŠ¶æ€ä½ å”¤é†’\nå…¶å®åœ¨ç¬¬5æ­¥ t4å”¤é†’ å¾€ä¸‹æ‰§è¡Œçš„æ—¶å€™å°±é”™è¯¯äº† çŠ¶æ€ä½éƒ½æ˜¯true \né—®é¢˜å‡ºçš„åœ°æ–¹å°±æ˜¯ ä¸ç®¡æ˜¯ç”Ÿäº§è€…è¿˜æ˜¯æ¶ˆè´¹è€… ï¼Œæ¯æ¬¡å”¤é†’çš„æ—¶å€™ ï¼Œéƒ½è¦å›å¤´åœ¨çœ‹ä¸€ä¸‹çŠ¶æ€ä½æ˜¯å¦æ­£ç¡® ï¼Œæ­£ç¡®åˆ™ç»§ç»­æ‰§è¡Œ å¦åˆ™å°±ç»§ç»­ä¼‘çœ ã€‚\nè§£å†³åŠæ³•ï¼šç”¨whileæ¥åˆ¤æ–­çŠ¶æ€ä½ä¿®æ”¹åçš„ç”Ÿäº§è€…æ–¹æ³•   /**\n     *ç”Ÿäº§æ–¹æ³•\n     */\n    public void producer()&#123;\n        synchronized (lock)&#123;\n            try&#123;\n                while(!sign)\n                    lock.wait();\n                System.out.println(Thread.currentThread().getName()+&quot; ç”Ÿäº§&quot;);\n                sign=false;\n                lock.notify();\n            &#125;catch (InterruptedException e)&#123;\n                e.printStackTrace();\n            &#125;\n        &#125;\n    &#125;\n\nä¿®æ”¹åçš„æ¶ˆè´¹è€…æ–¹æ³•   /**\n     * æ¶ˆè´¹æ–¹æ³•\n     */\n    public void consumer()&#123;\n        synchronized (lock)&#123;\n            try&#123;\n                while(sign)\n                    lock.wait();\n                System.out.println(Thread.currentThread().getName()+&quot; æ¶ˆè´¹&quot;);\n                sign=true;\n                lock.notify();\n            &#125;catch (InterruptedException e)&#123;\n                e.printStackTrace();\n            &#125;\n        &#125;\n    &#125;\n\nä¿®æ”¹å®Œä»£ç å æˆ‘ä»¬ç»§ç»­è¿è¡Œï¼š\n\nå¯ä»¥çœ‹åˆ°ç¨‹åºæ˜¯æ²¡æœ‰åœæ­¢äº† ä½†ä¸ºä»€ä¹ˆä¼šæ²¡æœ‰è¿è¡Œä¸‹å»å‘¢ï¼Ÿ\næ¥çœ‹æ ¸å¿ƒä»£ç ï¼š\nlock.notify();\n\nç°åœ¨æˆ‘ä»¬æ¥æ¨¡æ‹Ÿ åˆšåˆšå‘é€çš„æƒ…å†µçš„è¿™ç§æƒ…å†µç”Ÿäº§è€…:t1 t2 æ¶ˆè´¹è€…ï¼št3 t41æ­¥ï¼št3å¾—åˆ°è°ƒåº¦ åˆ¤æ–­çŠ¶æ€ä½ ä¼‘çœ   ï¼ˆä¼‘çœ ï¼št3ï¼‰\n2æ­¥ï¼št4å¾—åˆ°è°ƒåº¦  åˆ¤æ–­çŠ¶æ€ä½ ä¼‘çœ    (ä¼‘çœ ï¼št3  t4ï¼‰\n3æ­¥ï¼št1å¾—åˆ°è°ƒåº¦ åˆ¤æ–­çŠ¶æ€ä½  ç”Ÿäº§ å”¤é†’ t3   (ä¼‘çœ ï¼št4)\n4æ­¥ï¼št1åˆè¢«è°ƒåº¦  åˆ¤æ–­çŠ¶æ€ä½ ä¼‘çœ    (ä¼‘çœ ï¼št4  t1)\n5æ­¥ï¼št2å¾—åˆ°è°ƒåº¦  åˆ¤æ–­çŠ¶æ€ä½ ä¼‘çœ    (ä¼‘çœ ï¼št4  t1  t2)\n6æ­¥ï¼št3å¾—åˆ°è°ƒåº¦  åˆ¤æ–­çŠ¶æ€ä½  æ¶ˆè´¹  å”¤é†’t4  (ä¼‘çœ ï¼št1  t2)\n7æ­¥ï¼št3åˆè¢«è°ƒåº¦  åˆ¤æ–­çŠ¶æ€ä½  ä¼‘çœ   ï¼ˆä¼‘çœ ï¼št1 t2  t3ï¼‰\n8æ­¥ï¼šåªæœ‰t4å­˜æ´» å¾—åˆ°è°ƒåº¦ åˆ¤æ–­çŠ¶æ€ä½ ä¼‘çœ   ï¼ˆä¼‘çœ ï¼št1  t2 t3  t4ï¼‰\nè‡³æ­¤æ‰€ä»¥çº¿ç¨‹å…¨éƒ¨åˆ°äº†ä¼‘çœ çŠ¶æ€ ä¹Ÿæ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¼šå”¤é†’\nè§£å†³åŠæ³• ä½¿ç”¨lock.notifyAll();æ€»ç»“ï¼šåœ¨å¤šç”Ÿäº§è€…å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œåˆ¤æ–­çŠ¶æ€ä½çš„æ—¶å€™éœ€è¦ä½¿ç”¨whileåˆ¤æ–­ ï¼Œè¦ä¸ç„¶å¯èƒ½ä¼šé€ æˆ ä¸€æ¬¡ç”Ÿäº§å¤šæ¬¡æ¶ˆè´¹ï¼Œæˆ–è€…ä¸€æ¬¡æ¶ˆè´¹å¤šæ¬¡ç”Ÿäº§çš„æƒ…å†µï¼Œå”¤é†’çº¿ç¨‹ä½¿ç”¨notifyAll() ,è¦ä¸ç„¶å¯èƒ½ä¼šé€ æˆå…¨éƒ¨è¿›å…¥ä¼‘çœ çŠ¶æ€ å¯¼è‡´ç¨‹åºæ— æ³•è¿è¡Œã€‚å½“ç„¶è¿™åªæ˜¯ç”Ÿäº§è€… æ¶ˆè´¹è€…çš„ä¸€ç§å®ç°æ–¹æ³• è¿˜æœ‰å…¶ä»–å¤šç§å®ç°æ–¹æ³•ã€‚","tags":["è®¾è®¡æ¨¡å¼"]}]